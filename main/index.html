<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Gerrit Meier, Michael Simons">
<title>The Neo4j Cypher-DSL</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The Neo4j Cypher-DSL</h1>
<div class="details">
<span id="author" class="author">Gerrit Meier</span><br>
<span id="email" class="email"><a href="mailto:gerrit.meier@neo4j.com">gerrit.meier@neo4j.com</a></span><br>
<span id="author2" class="author">Michael Simons</span><br>
<span id="email2" class="email"><a href="mailto:michael.simons@neo4j.com">michael.simons@neo4j.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#purpose">1.1. Purpose</a></li>
<li><a href="#wheretouseit">1.2. Where to use it</a></li>
<li><a href="#javaapi">1.3. Java API</a></li>
</ul>
</li>
<li><a href="#getting-started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#preparedependencies">2.1. Prepare dependencies</a></li>
<li><a href="#how-to-use-it">2.2. How to use it</a></li>
</ul>
</li>
<li><a href="#properties">3. Properties</a></li>
<li><a href="#functions">4. Functions</a>
<ul class="sectlevel2">
<li><a href="#lists">4.1. Lists</a></li>
<li><a href="#mathematicalfunctions">4.2. Mathematical functions</a></li>
<li><a href="#callingarbitraryproceduresandfunctions">4.3. Calling arbitrary procedures and functions</a></li>
</ul>
</li>
<li><a href="#cypher-parser">5. Parsing existing Cypher</a>
<ul class="sectlevel2">
<li><a href="#introduction2">5.1. Introduction</a></li>
<li><a href="#gettingstarted">5.2. Getting started</a></li>
<li><a href="#cypher-parser-examples">5.3. Examples</a></li>
</ul>
</li>
<li><a href="#driver-integration">6. Integration with the Neo4j-Java-Driver</a>
<ul class="sectlevel2">
<li><a href="#introduction3">6.1. Introduction</a></li>
<li><a href="#addadditionaldependencies2">6.2. Add additional dependencies</a></li>
<li><a href="#imperative-api">6.3. Imperative (blocking) API</a></li>
<li><a href="#reactive-api">6.4. Reactive API</a></li>
</ul>
</li>
<li><a href="#static-meta-model">7. Building a static meta model</a>
<ul class="sectlevel2">
<li><a href="#concepts">7.1. Concepts</a></li>
<li><a href="#possibleusage">7.2. Possible Usage</a></li>
<li><a href="#thespringdataneo4j6annotationprocessor">7.3. The Spring Data Neo4j 6 annotation processor</a></li>
</ul>
</li>
<li><a href="#appendix">8. Appendix</a>
<ul class="sectlevel2">
<li><a href="#query-dsl-support">Query-DSL support</a></li>
<li><a href="#buildingtheneo4jcypher-dsl">Building the Neo4j Cypher-DSL</a></li>
<li><a href="#arch-rules">Architecture</a></li>
<li><a href="#changelog">Change log</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2020 Neo4j, Inc.,</p>
</div>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>This is the Neo4j Cypher-DSL manual version 2021.3.1-SNAPSHOT.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><em>Who should read this?</em></p>
</div>
<div class="paragraph">
<p>This manual is written for people interested in creating Cypher queries in a typesafe way on the JVM.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Cypher-DSL is considered <em>EXPERIMENTAL</em> at the time of writing.
This means you can and should use it and that we are looking actively for feedback, issues and problems.
We will try to keep breaking changes to a minimum, but we reserve the right to modify public methods, parameters
and behaviour in case we need those changes.
All public classes inside <code>org.neo4j.cypherdsl</code> still subject to breaking changes are annotated with <code>@API(status = EXPERIMENTAL)</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="purpose"><a class="anchor" href="#purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>The Cypher-DSL has been developed with the needs of Spring Data Neo4j.
We wanted to avoid string concatenations in our query generation and decided do go with a builder approach, much like we
find with <a href="https://www.jooq.org">jOOQ</a> or in the relational module of <a href="https://github.com/spring-projects/spring-data-jdbc/tree/1.1.6.RELEASE/spring-data-relational/src/main/java/org/springframework/data/relational/core/sql">Spring Data JDBC</a>, but for Cypher.</p>
</div>
<div class="paragraph">
<p>What we don&#8217;t have - and don&#8217;t need for our mapping purpose - at the moment is a code generator that reads the database schema
and generates static classes representing labels and relationship types.
That is still up to the mapping framework (in our case SDN).
We however have a type safe API for Cypher that allows only generating valid Cypher constructs.</p>
</div>
<div class="paragraph">
<p>We worked closely with the <a href="https://www.opencypher.org">OpenCypher spec</a> here and you find a lot of these concepts in the API.</p>
</div>
<div class="paragraph">
<p>The Cypher-DSL can also be seen in the same area as the <a href="https://docs.spring.io/spring-data/mongodb/docs/current/api/org/springframework/data/mongodb/core/query/Criteria.html">Criteria API</a> of Spring Data Mongo.</p>
</div>
</div>
<div class="sect2">
<h3 id="wheretouseit"><a class="anchor" href="#wheretouseit"></a>1.2. Where to use it</h3>
<div class="paragraph">
<p>The Cypher-DSL creates an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">Abstract Syntax Tree (AST)</a> representing your Cypher-Statements.
An instance of a <code>org.neo4j.cypherdsl.core.Statement</code> representing that AST is provided at the end of query building step.
A <code>Renderer</code> is then used to create literal Java-Strings.
Those can be used in any context supporting String-based queries, for example with the <a href="https://github.com/neo4j/neo4j-java-driver">Neo4j Java driver</a> or inside embedded procedures and of course with Spring Data&#8217;s <a href="https://github.com/spring-projects/spring-data-neo4j/blob/master/src/main/java/org/springframework/data/neo4j/core/Neo4jClient.java">Neo4j-Client</a>.</p>
</div>
<div class="paragraph">
<p>Parameters in the generated queries will use the <code>$form</code> and as such be compatible with all current versions of Neo4j.</p>
</div>
<div class="paragraph">
<p>Users of SDN 6+ can use the generated <code>org.neo4j.cypherdsl.core.Statement</code> directly with the <code>Neo4jTemplate</code> or the <code>ReactiveNeo4jTemplate</code>.
Both the imperative and the reactive variants allow the retrieval and counting of entities without rendering a String first,
for example through <code>Neo4jTemplate#findAll(Statement, Class&lt;T&gt;)</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="javaapi"><a class="anchor" href="#javaapi"></a>1.3. Java API</h3>
<div class="paragraph">
<p>Find the Java-API and a generated project info here: <a href="project-info/apidocs/index.html">API</a> and <a href="project-info/index.html">project info</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>2. Getting started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="preparedependencies"><a class="anchor" href="#preparedependencies"></a>2.1. Prepare dependencies</h3>
<div class="paragraph">
<p>Please use a dependency management system. We recommend either Maven or Gradle.</p>
</div>
<div class="sect3">
<h4 id="mavenconfiguration"><a class="anchor" href="#mavenconfiguration"></a>2.1.1. Maven configuration</h4>
<div class="listingblock">
<div class="title">Listing 1. Inclusion of the Neo4j Cypher-DSL in a Maven project</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.neo4j<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j-cypher-dsl<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>2021.3.1-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="gradleconfiguration"><a class="anchor" href="#gradleconfiguration"></a>2.1.2. Gradle configuration</h4>
<div class="listingblock">
<div class="title">Listing 2. Inclusion of the Neo4j Cypher-DSL in a Gradle project</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.neo4j:neo4j-cypher-dsl:2021.3.1-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="how-to-use-it"><a class="anchor" href="#how-to-use-it"></a>2.2. How to use it</h3>
<div class="paragraph">
<p>You use the Cypher-DSL as you would write Cypher:
it allows to write down even complex Cypher queries from top to bottom in a type safe, compile time checked way.</p>
</div>
<div class="paragraph">
<p>The examples to follow are using JDK 11.
We find the <code>var</code> keyword especially appealing in such a DSL as the types returned by the DSL are much less important than
the further building methods they offer.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The AST parts and intermediate build steps are immutable. That is, the methods create new intermediate steps.
For example, you cannot reuse an <code>ExposesLimit</code> step, but have to use the returned object from its <code>skip</code> method.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An instance of a <code>org.neo4j.cypherdsl.core.Statement</code> is provided at the end of every query building step.
This <code>Statement</code> needs to be rendered into a string or passed to methods supporting it as input.</p>
</div>
<div class="paragraph">
<p>Please get an instance of the default renderer via <code>org.neo4j.cypherdsl.renderer.Renderer#getDefaultRenderer()</code>.
The renderer provides a single method <code>render</code> for rendering the AST into a string representation.</p>
</div>
<div class="paragraph">
<p>Furthermore, the <code>Statement</code> will collect parameter names and if provided, parameter values.
Parameter names and values are available after the statement has been built and can for example be used directly with
Neo4j-Java-Driver.</p>
</div>
<div class="sect3">
<h4 id="how-to-use-it.examples"><a class="anchor" href="#how-to-use-it.examples"></a>2.2.1. Examples</h4>
<div class="paragraph">
<p>The following examples are 1:1 copies of the queries you will find in the Neo4j browser after running <code>:play movies</code>.</p>
</div>
<div class="paragraph">
<p>They use the following imports:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Imports needed for the examples to compile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.assertj.core.api.Assertions.assertThat</span>;

<span class="keyword">import</span> <span class="include">java.util.Collection</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Conditions</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Cypher</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Functions</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Statement</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.SymbolicName</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.renderer.Configuration</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.renderer.Renderer</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To match and return all the movie, build your statement like this:</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. Simple match</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var m = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
var statement = Cypher.match(m) <i class="conum" data-value="2"></i><b>(2)</b>
    .returning(m)
    .build(); <i class="conum" data-value="3"></i><b>(3)</b>

assertThat(cypherRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (m:`Movie`) RETURN m</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare a variable storing your node labeled <code>Movie</code> and named <code>m</code>, so that you can</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>reuse it in both the match and the return part.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>build</code> method becomes only available when a compilable Cypher statement can be rendered.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="find"><a class="anchor" href="#find"></a>Find</h5>
<div class="paragraph">
<p>Match all nodes with a given set of properties:</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Find the actor named "Tom Hanks"&#8230;&#8203;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var tom = Cypher.anyNode().named(<span class="string"><span class="delimiter">&quot;</span><span class="content">tom</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tom Hanks</span><span class="delimiter">&quot;</span></span>));
var statement = Cypher
    .match(tom).returning(tom)
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (tom {name: 'Tom Hanks'}) RETURN tom</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Limit the number of returned things and return only one attribute</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. Find 10 people&#8230;&#8203;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var people = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">people</span><span class="delimiter">&quot;</span></span>);
statement = Cypher
    .match(people)
    .returning(people.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
    .limit(<span class="integer">10</span>)
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (people:`Person`) RETURN people.name LIMIT 10</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create complex conditions</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. Find movies released in the 1990s&#8230;&#8203;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var nineties = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">nineties</span><span class="delimiter">&quot;</span></span>);
var released = nineties.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">released</span><span class="delimiter">&quot;</span></span>);
statement = Cypher
    .match(nineties)
    .where(released.gte(Cypher.literalOf(<span class="integer">1990</span>)).and(released.lt(Cypher.literalOf(<span class="integer">2000</span>))))
    .returning(nineties.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>))
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (nineties:`Movie`) WHERE (nineties.released &gt;= 1990 AND nineties.released &lt; 2000) RETURN nineties.title</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="query"><a class="anchor" href="#query"></a>Query</h5>
<div class="paragraph">
<p>Build relationships</p>
</div>
<div class="listingblock">
<div class="title">Listing 8. List all Tom Hanks movies&#8230;&#8203;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var tom = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">tom</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tom Hanks</span><span class="delimiter">&quot;</span></span>));
var tomHanksMovies = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">tomHanksMovies</span><span class="delimiter">&quot;</span></span>);
var statement = Cypher
    .match(tom.relationshipTo(tomHanksMovies, <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>))
    .returning(tom, tomHanksMovies)
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (tom:`Person` {name: 'Tom Hanks'})-[:`ACTED_IN`]-&gt;(tomHanksMovies) RETURN tom, tomHanksMovies</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 9. Who directed "Cloud Atlas"?</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var cloudAtlas = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">cloudAtlas</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cloud Atlas</span><span class="delimiter">&quot;</span></span>));
var directors = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">directors</span><span class="delimiter">&quot;</span></span>);
statement = Cypher
    .match(cloudAtlas.relationshipFrom(directors, <span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTED</span><span class="delimiter">&quot;</span></span>))
    .returning(directors.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (cloudAtlas {title: 'Cloud Atlas'})&lt;-[:`DIRECTED`]-(directors) RETURN directors.name</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 10. Tom Hanks' co-actors&#8230;&#8203;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">tom = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">tom</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tom Hanks</span><span class="delimiter">&quot;</span></span>));
var movie = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);
var coActors = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">coActors</span><span class="delimiter">&quot;</span></span>);
var people = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">people</span><span class="delimiter">&quot;</span></span>);
statement = Cypher
    .match(tom.relationshipTo(movie, <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>).relationshipFrom(coActors, <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>))
    .returning(coActors.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (tom:`Person` {name: 'Tom Hanks'})-[:`ACTED_IN`]-&gt;(m)&lt;-[:`ACTED_IN`]-(coActors) RETURN coActors.name</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Listing 11. How people are related to "Cloud Atlas"&#8230;&#8203;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">cloudAtlas = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cloud Atlas</span><span class="delimiter">&quot;</span></span>));
people = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">people</span><span class="delimiter">&quot;</span></span>);
var relatedTo = people.relationshipBetween(cloudAtlas).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">relatedTo</span><span class="delimiter">&quot;</span></span>);
statement = Cypher
    .match(relatedTo)
    .returning(people.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), Functions.type(relatedTo), relatedTo.getRequiredSymbolicName())
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (people:`Person`)-[relatedTo]-(:`Movie` {title: 'Cloud Atlas'}) RETURN people.name, type(relatedTo), relatedTo</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="solve"><a class="anchor" href="#solve"></a>Solve</h5>
<div class="listingblock">
<div class="title">Listing 12. Movies and actors up to 4 "hops" away from Kevin Bacon</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var bacon = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">bacon</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Kevin Bacon</span><span class="delimiter">&quot;</span></span>));
var hollywood = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">hollywood</span><span class="delimiter">&quot;</span></span>);
var statement = Cypher
    .match(bacon.relationshipBetween(hollywood).length(<span class="integer">1</span>, <span class="integer">4</span>))
    .returningDistinct(hollywood)
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (bacon:`Person` {name: 'Kevin Bacon'})-[*1..4]-(hollywood) RETURN DISTINCT hollywood</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="recommend"><a class="anchor" href="#recommend"></a>Recommend</h5>
<div class="listingblock">
<div class="title">Listing 13. Extend Tom Hanks co-actors, to find co-co-actors who haven&#8217;t worked with Tom Hanks&#8230;&#8203;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var tom = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">tom</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Tom Hanks</span><span class="delimiter">&quot;</span></span>));
var coActors = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">coActors</span><span class="delimiter">&quot;</span></span>);
var cocoActors = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">cocoActors</span><span class="delimiter">&quot;</span></span>);
var strength = Functions.count(Cypher.asterisk()).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">Strength</span><span class="delimiter">&quot;</span></span>);
var statement = Cypher
    .match(
        tom.relationshipTo(Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>).relationshipFrom(coActors, <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>),
        coActors.relationshipTo(Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">m2</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>).relationshipFrom(cocoActors, <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>)
    )
    .where(
        Conditions.not(tom.relationshipTo(Cypher.anyNode(), <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>).relationshipFrom(cocoActors, <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>)))
    .and(tom.isNotEqualTo(cocoActors))
    .returning(
        cocoActors.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recommended</span><span class="delimiter">&quot;</span></span>),
        strength
    ).orderBy(strength.asName().descending())
    .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">(tom:`Person` {name: 'Tom Hanks'})-[:`ACTED_IN`]-&gt;(m)&lt;-[:`ACTED_IN`]-(coActors), </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">(coActors)-[:`ACTED_IN`]-&gt;(m2)&lt;-[:`ACTED_IN`]-(cocoActors) </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">WHERE (NOT (tom)-[:`ACTED_IN`]-&gt;()&lt;-[:`ACTED_IN`]-(cocoActors) AND tom &lt;&gt; cocoActors) </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN cocoActors.name AS Recommended, count(*) AS Strength ORDER BY Strength DESC</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="morefeatures"><a class="anchor" href="#morefeatures"></a>2.2.2. More features</h4>
<div class="sect4">
<h5 id="retrieving-parameters"><a class="anchor" href="#retrieving-parameters"></a>Retrieving parameters being defined</h5>
<div class="paragraph">
<p>A placeholder for a parameter can be defined via <code>Cypher.parameter("param")</code>.
This placeholder will be rendered as <code>$param</code> and must be filled with the appropriate means of the environment you&#8217;re working with.</p>
</div>
<div class="paragraph">
<p>In addition, an arbitrary value can be bound to the name via <code>Cypher.parameter("param", "a value")</code> or <code>Cypher.parameter("param").withValue("a value")</code>.
<code>NULL</code> is a valid value.
The Cypher-DSL will not use those values, but collect them for you.</p>
</div>
<div class="paragraph">
<p>The following example shows how to access them and how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var person = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>);
var statement =
    Cypher
        .match(person)
        .where(person.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">nickname</span><span class="delimiter">&quot;</span></span>).isEqualTo(Cypher.parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">nickname</span><span class="delimiter">&quot;</span></span>)))
        .set(
            person.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>).to(Cypher.parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>).withValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Thomas</span><span class="delimiter">&quot;</span></span>)),
            person.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).to(Cypher.parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Anderson</span><span class="delimiter">&quot;</span></span>))
        )
        .returning(person)
        .build();

assertThat(cypherRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:`Person`) WHERE p.nickname = $nickname SET p.firstName = $firstName, p.name = $name RETURN p</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; parameterNames = statement.getParameterNames();
assertThat(parameterNames).containsExactlyInAnyOrder(<span class="string"><span class="delimiter">&quot;</span><span class="content">nickname</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>

<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; parameters = statement.getParameters();
assertThat(parameters).hasSize(<span class="integer">2</span>); <i class="conum" data-value="2"></i><b>(2)</b>
assertThat(parameters).containsEntry(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Thomas</span><span class="delimiter">&quot;</span></span>);
assertThat(parameters).containsEntry(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Anderson</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The names contain all placeholders, also those without a value</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The parameter map contains only parameters with defined values</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you define a parameter with conflicting values, a <code>ConflictingParametersException</code> will be thrown the moment you try to retrieve the collected parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="usingthedefaultrenderer"><a class="anchor" href="#usingthedefaultrenderer"></a>Using the default renderer</h5>
<div class="paragraph">
<p>A statement can render itself as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var statement = Cypher.returning(literalTrue().as(<span class="string"><span class="delimiter">&quot;</span><span class="content">t</span><span class="delimiter">&quot;</span></span>)).build();
var cypher = statement.getCypher();
assertThat(cypher).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN true AS t</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This, together with <a href="#retrieving-parameters">the above</a>, makes the statement a complete accessor for a Cypher-statement and its parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="generatingformattedcypher"><a class="anchor" href="#generatingformattedcypher"></a>Generating formatted Cypher</h5>
<div class="paragraph">
<p>The Cypher-DSL can also format the generated Cypher to some extend.
The <code>Renderer</code> offers the overload <code>Renderer getRenderer(Configuration configuration)</code>, taking in an instance of <code>org.neo4j.cypherdsl.core.renderer.Configuration</code>.</p>
</div>
<div class="paragraph">
<p>Instances of <code>Configuration</code> are thread-safe and reusable.
The class offers a couple of static convenience methods for retrieving some variants.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var n = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>);
var a = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
var b = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">B</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>);

var mergeStatement = Cypher.merge(n)
    .onCreate().set(n.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">prop</span><span class="delimiter">&quot;</span></span>).to(Cypher.literalOf(<span class="integer">0</span>)))
    .merge(a.relationshipBetween(b, <span class="string"><span class="delimiter">&quot;</span><span class="content">T</span><span class="delimiter">&quot;</span></span>))
    .onCreate().set(a.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).to(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">me</span><span class="delimiter">&quot;</span></span>)))
    .onMatch().set(b.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).to(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">you</span><span class="delimiter">&quot;</span></span>)))
    .returning(a.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">prop</span><span class="delimiter">&quot;</span></span>)).build();

var renderer = <span class="predefined-type">Renderer</span>.getRenderer(<span class="predefined-type">Configuration</span>.prettyPrinting()); <i class="conum" data-value="1"></i><b>(1)</b>
assertThat(renderer.render(mergeStatement))
    .isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE (n)</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">  ON CREATE SET n.prop = 0</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE (a:A)-[:T]-(b:B)</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">  ON CREATE SET a.name = 'me'</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">  ON MATCH SET b.name = 'you'</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN a.prop</span><span class="delimiter">&quot;</span></span>
    ); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get a "pretty printing" instance of the renderer configuration and retrieve a renderer based on it</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enjoy formatted Cypher.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="escapingnames"><a class="anchor" href="#escapingnames"></a>Escaping names</h5>
<div class="paragraph">
<p>The default renderer in its default configuration will escape all names (labels and relationship types) by default.
So <code>Movie</code> becomes <code>`Movie`</code> and <code>ACTED_IN</code> becomes <code>`ACTED_IN`</code>.
If you don&#8217;t want this, you can either create a dedicated configuration for a renderer with that setting turned off or use
the pretty printing renderer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var relationship = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>)
    .relationshipTo(Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>);

var statement = Cypher.match(relationship).returning(relationship).build();

var defaultRenderer = <span class="predefined-type">Renderer</span>.getDefaultRenderer();
assertThat(defaultRenderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (a:`Person`)-[r:`ACTED_IN`]-&gt;(m:`Movie`) RETURN r</span><span class="delimiter">&quot;</span></span>);

var escapeOnlyIfNecessary = <span class="predefined-type">Configuration</span>.newConfig().alwaysEscapeNames(<span class="predefined-constant">false</span>).build();

var renderer = <span class="predefined-type">Renderer</span>.getRenderer(escapeOnlyIfNecessary);
assertThat(renderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (a:Person)-[r:ACTED_IN]-&gt;(m:Movie) RETURN r</span><span class="delimiter">&quot;</span></span>);

renderer = <span class="predefined-type">Renderer</span>.getRenderer(<span class="predefined-type">Configuration</span>.prettyPrinting());
assertThat(renderer.render(statement))
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (a:Person)-[r:ACTED_IN]-&gt;(m:Movie)</span><span class="char">\n</span><span class="content">RETURN r</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="insertingrawcypher"><a class="anchor" href="#insertingrawcypher"></a>Inserting raw Cypher</h5>
<div class="paragraph">
<p><code>Cypher.raw</code> allows for creating arbitrary expressions from raw String literals.
Users discretion is advised:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var key = Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>);
var cypher = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">apoc.meta.schema</span><span class="delimiter">&quot;</span></span>)
    .yield(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>).with(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)
    .unwind(Functions.keys(Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>))).as(key)
    .returning(
        key,
        Cypher.raw(<span class="string"><span class="delimiter">&quot;</span><span class="content">value[$E]</span><span class="delimiter">&quot;</span></span>, key).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .build().getCypher();

assertThat(cypher).isEqualTo(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">CALL apoc.meta.schema() YIELD value WITH value UNWIND keys(value) AS key RETURN key, value[key] AS value</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Cypher-DSL doesn&#8217;t support a dynamic lookup of properties on expression at the moment.
We use a raw Cypher string with the placeholder <code>$E</code> which resolves to the symbolic name also passed to the <code>raw</code> function.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="properties"><a class="anchor" href="#properties"></a>3. Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nodes and Relationships expose properties.
This reflects directly in the Cypher-DSL:</p>
</div>
<div id="properties-on-nodes-and-rel" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var personNode = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>);
var movieNode = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>);
var ratedRel = personNode.relationshipTo(movieNode, <span class="string"><span class="delimiter">&quot;</span><span class="content">RATED</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>);
var statement = Cypher.match(ratedRel)
        .returning(
                personNode.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), <i class="conum" data-value="1"></i><b>(1)</b>
                ratedRel.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">rating</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="2"></i><b>(2)</b>
        .build();

assertThat(cypherRenderer.render(statement))
        .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:`Person`)-[r:`RATED`]-&gt;(:`Movie`) RETURN p.name, r.rating</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a property expression from a <code>Node</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create a property expression from a <code>Relationship</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both Node and Relationship should be named as in the example.
The Cypher-DSL generates names if they are not named, to refer to them in the statements.
Without the explicit names, the generated statement would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (geIcWNUD000:`Person`)-[TqfqBNcc001:`RATED`]-&gt;(:`Movie`) RETURN geIcWNUD000.name, TqfqBNcc001.rating</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name is of course random.</p>
</div>
<div class="paragraph">
<p>The <code>Cypher</code> class exposes the <code>property</code> method, too. This methods takes in one name (as symbolic name or as string literal) OR one expression
and  at least one further string, referring to the name of the property.</p>
</div>
<div class="paragraph">
<p>Passing in a symbolic name would lead to a similar result like in <a href="#properties-on-nodes-and-rel">[properties-on-nodes-and-rel]</a>, an expression can refer
to the results of functions etc.:</p>
</div>
<div id="properties-on-expressions" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var epochSeconds = Cypher.property(Functions.datetime(), <span class="string"><span class="delimiter">&quot;</span><span class="content">epochSeconds</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
var statement = Cypher.returning(epochSeconds).build();
Assertions.assertThat(cypherRenderer.render(statement))
        .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN datetime().epochSeconds</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here an expression, the <code>datetime()</code> function is passed in and the <code>epocheSeconds</code> property is dereferenced.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nested properties are of course possible as well, either directly on nodes and relationships or via the static builder:</p>
</div>
<div id="nested-properties" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var node = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>);

var locationPropV1 = Cypher.property(node.getRequiredSymbolicName(), <span class="string"><span class="delimiter">&quot;</span><span class="content">home.location</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>);
var locationPropV2 = Cypher.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">home.location</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>);

var statement = Cypher.match(node)
        .where(locationPropV1.gt(Cypher.literalOf(<span class="integer">50</span>)))
        .returning(locationPropV2).build();

assertThat(cypherRenderer.render(statement))
        .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:`Person`) WHERE p.`home.location`.y &gt; 50 RETURN p.`home.location`.y</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="functions"><a class="anchor" href="#functions"></a>4. Functions</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are many more functions implemented in <code>org.neo4j.cypherdsl.core.Functions</code>. Not all of them are already documented here.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="lists"><a class="anchor" href="#lists"></a>4.1. Lists</h3>
<div class="sect3">
<h4 id="functions-list-range"><a class="anchor" href="#functions-list-range"></a>4.1.1. range()</h4>
<div class="paragraph">
<p>Creates an invocation of <a href="https://neo4j.com/docs/cypher-manual/current/functions/list/#functions-range"><code>range()</code></a>.</p>
</div>
<div class="paragraph">
<p>Given the following imports</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Cypher</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Functions</span>;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var range = Functions.range(<span class="integer">0</span>, <span class="integer">10</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives you <code>range(0,10)</code>.
The step size can be specified as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var range = Functions.range(<span class="integer">0</span>, <span class="integer">10</span>, <span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This gives you <code>range(0,10,1)</code>.</p>
</div>
<div class="paragraph">
<p>Both variants of <code>range</code> also take a <code>NumberLiteral</code> for the start and end index and the step size.</p>
</div>
</div>
<div class="sect3">
<h4 id="insertingalistoperator"><a class="anchor" href="#insertingalistoperator"></a>4.1.2. Inserting a list operator</h4>
<div class="paragraph">
<p>The <em>list operator</em> <code>[]</code> selects a specific value of a list or a range of values from a list.
A range can either be closed or open.</p>
</div>
<div class="paragraph">
<p>Find examples to select a value at a given index, a sublist based on a closed range and sublist based on open ranges below.
While the examples use <a href="#functions-list-range">Section 4.1.1</a>, the list operator doesn&#8217;t put any restrictions on the expression at the moment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="type">void</span> valueAtExample() {

        var range = Functions.range(<span class="integer">0</span>, <span class="integer">10</span>);

        var statement = Cypher.returning(Cypher.valueAt(range, <span class="integer">3</span>)).build();
        assertThat(cypherRenderer.render(statement))
                .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN range(0, 10)[3]</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@Test</span>
<span class="type">void</span> subListUntilExample() {

        var range = Functions.range(Cypher.literalOf(<span class="integer">0</span>), Cypher.literalOf(<span class="integer">10</span>));

        var statement = Cypher.returning(Cypher.subListUntil(range, <span class="integer">3</span>)).build();
        assertThat(cypherRenderer.render(statement))
                .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN range(0, 10)[..3]</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@Test</span>
<span class="type">void</span> subListFromExample() {

        var range = Functions.range(<span class="integer">0</span>, <span class="integer">10</span>, <span class="integer">1</span>);

        var statement = Cypher.returning(Cypher.subListFrom(range, -<span class="integer">3</span>)).build();
        assertThat(cypherRenderer.render(statement))
                .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN range(0, 10, 1)[-3..]</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@Test</span>
<span class="type">void</span> subListExample() {

        var range = Functions.range(Cypher.literalOf(<span class="integer">0</span>), Cypher.literalOf(<span class="integer">10</span>), Cypher.literalOf(<span class="integer">1</span>));

        var statement = Cypher.returning(Cypher.subList(range, <span class="integer">2</span>, <span class="integer">4</span>)).build();
        assertThat(cypherRenderer.render(statement))
                .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN range(0, 10, 1)[2..4]</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mathematicalfunctions"><a class="anchor" href="#mathematicalfunctions"></a>4.2. Mathematical functions</h3>
<div class="paragraph">
<p>The Cypher-DSL supports all mathematical functions as of Neo4j 4.2. Please find
their description in the Neo4j cypher manual:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://neo4j.com/docs/cypher-manual/current/functions/mathematical-numeric/">Numeric</a></p>
</li>
<li>
<p><a href="https://neo4j.com/docs/cypher-manual/current/functions/mathematical-logarithmic/">Logarithmic</a></p>
</li>
<li>
<p><a href="https://neo4j.com/docs/cypher-manual/current/functions/mathematical-trigonometric/">Trigonometric</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="callingarbitraryproceduresandfunctions"><a class="anchor" href="#callingarbitraryproceduresandfunctions"></a>4.3. Calling arbitrary procedures and functions</h3>
<div class="paragraph">
<p>Neo4j has plethora of built-in procedures and functions.
The Cypher-DSL does cover a lot of them already, and they can be called in a typesafe way on many <code>Expression</code>-instances
taking in various expressions such as the results of other calls, literals or parameters.</p>
</div>
<div class="paragraph">
<p>However, there will probably always be a gap between what the Cypher-DSL includes and what the Neo4j database brings.
More so, there are fantastic libraries out there like <a href="https://neo4j.com/labs/apoc/">APOC</a>.
APOC has so many procedures and functions in so many categories that it is rather futile to add shims
for all of them consistently.</p>
</div>
<div class="paragraph">
<p>Probably the most important aspect of all: many Neo4j users bring their knowledge to the database themselves,
in the form of their stored procedures. Those should be callable as well.</p>
</div>
<div class="paragraph">
<p>The Cypher-DSL is flexible enough to call all those procedures and functions.</p>
</div>
<div class="sect3">
<h4 id="callingcustomprocedures"><a class="anchor" href="#callingcustomprocedures"></a>4.3.1. Calling custom procedures</h4>
<div class="paragraph">
<p>Procedures are called via the Cypher <a href="https://neo4j.com/docs/cypher-manual/current/clauses/call/">CALL-Clause</a>.
The CALL-Clause can appear as a <a href="https://s3.amazonaws.com/artifacts.opencypher.org/M15/railroad/StandaloneCall.html">StandAlone call</a>
and as an <a href="https://s3.amazonaws.com/artifacts.opencypher.org/M15/railroad/InQueryCall.html">InQuery call</a>.
Both are supported by the Cypher-DSL.</p>
</div>
<div class="sect4">
<h5 id="standaloneprocedurecalls"><a class="anchor" href="#standaloneprocedurecalls"></a>Standalone procedure calls</h5>
<div class="paragraph">
<p>Standalone calls are particular useful for <code>VOID</code> procedures.
A VOID procedure is a procedure that does not declare any result fields and returns no result records and that has explicitly been declared as <code>VOID</code>.
Let&#8217;s take the first example <a href="https://neo4j.com/docs/cypher-manual/current/clauses/call/#call-call-a-procedure-using-call">from here</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var call = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">db</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">labels</span><span class="delimiter">&quot;</span></span>).build(); <i class="conum" data-value="1"></i><b>(1)</b>
assertThat(cypherRenderer.render(call)).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CALL db.labels()</span><span class="delimiter">&quot;</span></span>);

call = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">db.labels</span><span class="delimiter">&quot;</span></span>).build();  <i class="conum" data-value="2"></i><b>(2)</b>
assertThat(cypherRenderer.render(call)).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CALL db.labels()</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Cypher.call</code> returns a buildable statement that can be rendered.
<code>Cypher.call</code> can be used with separate namespace and procedure name as shown here or</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>with a single argument equal to the name of the procedure.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course, arguments can be specified as expressions.
Expressions can be literals as in <a href="#standalone-call-with-args">[standalone-call-with-args]</a>, Cypher parameters (via <code>Cypher.parameter</code>) that bind your input or nested calls:</p>
</div>
<div id="standalone-call-with-args" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var call = Cypher
        .call(<span class="string"><span class="delimiter">&quot;</span><span class="content">dbms.security.createUser</span><span class="delimiter">&quot;</span></span>)
        .withArgs(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">johnsmith</span><span class="delimiter">&quot;</span></span>), Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">h6u4%kr</span><span class="delimiter">&quot;</span></span>), Cypher.literalFalse())
        .build();
assertThat(cypherRenderer.render(call))
        .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CALL dbms.security.createUser('johnsmith', 'h6u4%kr', false)</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last but not least, the Cypher-DSL can of course <code>YIELD</code> the results from a standalone call:</p>
</div>
<div id="standalone-call-yielding" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var call = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">dbms.procedures</span><span class="delimiter">&quot;</span></span>).yield(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">signature</span><span class="delimiter">&quot;</span></span>).build(); <i class="conum" data-value="1"></i><b>(1)</b>
assertThat(cypherRenderer.render(call)).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CALL dbms.procedures() YIELD name, signature</span><span class="delimiter">&quot;</span></span>);

call = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">dbms.procedures</span><span class="delimiter">&quot;</span></span>).yield(Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>), Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">signature</span><span class="delimiter">&quot;</span></span>)).build(); <i class="conum" data-value="2"></i><b>(2)</b>
assertThat(cypherRenderer.render(call)).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CALL dbms.procedures() YIELD name, signature</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Yielded items can be specified via string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>or with symbolic names created earlier</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A standalone call can spot a <code>WHERE</code> clause as well:</p>
</div>
<div id="standalone-call-where" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var name = Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
var call = Cypher
        .call(<span class="string"><span class="delimiter">&quot;</span><span class="content">dbms.listConfig</span><span class="delimiter">&quot;</span></span>)
        .withArgs(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">browser</span><span class="delimiter">&quot;</span></span>))
        .yield(name)
        .where(name.matches(<span class="string"><span class="delimiter">&quot;</span><span class="content">browser</span><span class="char">\\</span><span class="content">.allow.*</span><span class="delimiter">&quot;</span></span>))
        .returning(Cypher.asterisk())
        .build();
assertThat(cypherRenderer.render(call)).isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">CALL dbms.listConfig('browser') YIELD name WHERE name =~ 'browser</span><span class="char">\\</span><span class="char">\\</span><span class="content">.allow.*' RETURN *</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="in-queryprocedurecalls"><a class="anchor" href="#in-queryprocedurecalls"></a>In-query procedure calls</h5>
<div class="paragraph">
<p>In-query calls are only possible with non-void procedures. An In-query call happens inside the flow of a normal query.
The mechanics to construct those calls via the Cypher-DSL are identical to standalone calls:</p>
</div>
<div id="in-query-calls" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var label = Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>);
var statement = Cypher
        .match(Cypher.anyNode().named(<span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>)).with(<span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>)
        .call(<span class="string"><span class="delimiter">&quot;</span><span class="content">db.labels</span><span class="delimiter">&quot;</span></span>).yield(label).with(label)
        .returning(Functions.count(label).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">numLabels</span><span class="delimiter">&quot;</span></span>))
        .build();
assertThat(cypherRenderer.render(statement)).isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n) WITH n CALL db.labels() YIELD label WITH label RETURN count(label) AS numLabels</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>CALL</code> can be used after a <code>MATCH</code>, a <code>WITH</code> and also a <code>WHERE</code> clause.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="usestored-procedure-callsasexpressionscallingcustomfunctions"><a class="anchor" href="#usestored-procedure-callsasexpressionscallingcustomfunctions"></a>4.3.2. Use stored-procedure-calls as expressions (Calling custom functions)</h4>
<div class="paragraph">
<p>All the mechanics described and shown above - how to define a custom call statement, supply it with arguments etc. - doesn&#8217;t
distinguish between procedures and functions.
Every stored procedure can be treated as a function - as long as the stored procedure returns a single value.
It doesn&#8217;t matter if the single value returns a scalar or a list of objects.
A list of objects is still a single value, in contrast to a stream of objects returned by a non-void procedure.</p>
</div>
<div class="paragraph">
<p>So the question is not how to call a stored custom function, but how to turn a call statement into an expression that can be used in any place in a query where an expression is valid.
This is where <code>asFunction</code> comes in.</p>
</div>
<div id="as-function" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var p = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>);
var createUuid = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">apoc.create.uuid</span><span class="delimiter">&quot;</span></span>).asFunction(); <i class="conum" data-value="1"></i><b>(1)</b>
var statement = Cypher.merge(p.withProperties(Cypher.mapOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, createUuid))) <i class="conum" data-value="2"></i><b>(2)</b>
        .set(
                p.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>).to(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Michael</span><span class="delimiter">&quot;</span></span>)),
                p.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>).to(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hunger</span><span class="delimiter">&quot;</span></span>))
        )
        .returning(p)
        .build();
assertThat(cypherRenderer.render(statement)).isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE (p:`Person` {id: apoc.create.uuid()}) </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">SET p.firstName = 'Michael', p.surname = 'Hunger' </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN p</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>First we define a call as seen earlier and turn it into an expression</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This expression is than used as any other expression</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course, arguments to those functions can be expressed as well, either as literals or expressions.</p>
</div>
<div id="as-function-with-args" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var p = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>);
var createUuid = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">apoc.create.uuid</span><span class="delimiter">&quot;</span></span>).asFunction(); <i class="conum" data-value="1"></i><b>(1)</b>
var toCamelCase = Cypher.call(<span class="string"><span class="delimiter">&quot;</span><span class="content">apoc.text.camelCase</span><span class="delimiter">&quot;</span></span>)
        .withArgs(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">first name</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="2"></i><b>(2)</b>
        .asFunction();
var statement = Cypher.merge(p.withProperties(Cypher.mapOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>,
        createUuid)))
        .set(p.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>).to(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Simons</span><span class="delimiter">&quot;</span></span>)))
        .with(p)
        .call(<span class="string"><span class="delimiter">&quot;</span><span class="content">apoc.create.setProperty</span><span class="delimiter">&quot;</span></span>).withArgs(
                p.getRequiredSymbolicName(),
                toCamelCase,
                Cypher.parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">nameParam</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
        ).yield(<span class="string"><span class="delimiter">&quot;</span><span class="content">node</span><span class="delimiter">&quot;</span></span>)
        .returning(<span class="string"><span class="delimiter">&quot;</span><span class="content">node</span><span class="delimiter">&quot;</span></span>)
        .build();
assertThat(cypherRenderer.render(statement)).isEqualTo(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE (p:`Person` {id: apoc.create.uuid()}) SET p.surname = 'Simons' </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">WITH p CALL apoc.create.setProperty(p, apoc.text.camelCase('first name'), $nameParam) </span><span class="delimiter">&quot;</span></span>
        + <span class="string"><span class="delimiter">&quot;</span><span class="content">YIELD node RETURN node</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Same as before</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A call to APOC&#8217;s <code>camelCase</code> function, taking in the literal of <code>first name</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A call to another APOC function to which a parameter is passed. You find that corresponding placeholder as <code>$nameParam</code> in the following assert</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="summary"><a class="anchor" href="#summary"></a>4.3.3. Summary</h4>
<div class="paragraph">
<p>Through <code>Cypher.call</code> any procedure or function can be called in case one of your favorite procedures is missing in <code>org.neo4j.cypherdsl.core.Functions</code>.
All clauses, including <code>YIELD</code> and <code>WHERE</code> on procedures are supported.
All procedures can be turned into functions.
The Cypher-DSL however does not check if the procedure that is used as a function is actually eligible to do so.</p>
</div>
<div class="paragraph">
<p>If the Cypher-DSL misses an important builtin Neo4j function, please raise a <a href="https://github.com/neo4j-contrib/cypher-dsl/issues/new">ticket</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cypher-parser"><a class="anchor" href="#cypher-parser"></a>5. Parsing existing Cypher</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction2"><a class="anchor" href="#introduction2"></a>5.1. Introduction</h3>
<div class="paragraph">
<p>The <code>cypher-dsl-parser</code> module ins an optional add-on to the Cypher-DSL that takes your existing Cypher - either whole statements
or fragments like clauses or expressions - and turn them into Cypher-DSL statements or expressions.
Those fragments can be used to add custom Cypher to your generated statements without resorting to raw String literals.
It allows sanitizing user input, add additional filters for labels and types to rewrite queries and more.</p>
</div>
<div class="paragraph">
<p>The parser itself is based on Neo4j&#8217;s official Cypher-Parser, thus supporting the same constructs as Neo4j itself.
However, while we could theoretically parse all expressions that Neo4j 4.3.2 supports, we might cannot translate all of them
into elements of the Cypher-DSL. In such cases an <code>UnsupportedOperationException</code> will be thrown.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The current version of the Cypher-DSL-Parser modules is rather big. This is due to the fact that we must shade the
      Scala-Lang library. Neo4j&#8217;s parsers depends on it. This is likely to change in the future. Until then, we rather not
      try to shade only the few required classes and risk a <code>ClassNotFoundException</code>, but include the whole library.
     <br>
      The decision for shading has been made for compatibility reasons: People may have a different Scala version in place
      or might even use this library embedded. So it&#8217;s safer to shade what we support and not depend on it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="gettingstarted"><a class="anchor" href="#gettingstarted"></a>5.2. Getting started</h3>
<div class="sect3">
<h4 id="addadditionaldependencies"><a class="anchor" href="#addadditionaldependencies"></a>5.2.1. Add additional dependencies</h4>
<div class="sect4">
<h5 id="maven"><a class="anchor" href="#maven"></a>Maven</h5>
<div class="listingblock">
<div class="title">Listing 14. Cypher-DSL parser added via Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.neo4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-cypher-dsl-parser<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2021.3.1-SNAPSHOT<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gradle"><a class="anchor" href="#gradle"></a>Gradle</h5>
<div class="listingblock">
<div class="title">Listing 15. Gradle variant for additional dependencies</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">org.neo4j:neo4j-cypher-dsl-parser:2021.3.1-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="minimumjdkversion"><a class="anchor" href="#minimumjdkversion"></a>5.2.2. Minimum JDK version</h4>
<div class="paragraph">
<p>The Cypher-Parser requires JDK 11 to run which is the same version that Neo4j 4.3.2 requires.</p>
</div>
</div>
<div class="sect3">
<h4 id="mainentrypoint"><a class="anchor" href="#mainentrypoint"></a>5.2.3. Main entry point</h4>
<div class="paragraph">
<p>The main entry point to parsing Cypher strings into Cypher-DSL objects is</p>
</div>
<div id="main-entry-pint" class="listingblock">
<div class="title">Listing 16. Cypher Parser</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.parser.CypherParser</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It provides a list of static methods:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">What it does</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parseNode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parses a pattern like <code>(n:Node {withOrWithout: 'properties'})</code> into a <code>Node</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parseRelationship</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parses a pattern like <code>(m)-[{a: 'b', c: 'd'}]&#8594;(n)</code> into a <code>RelationshipPattern</code>.
 The pattern might be a <code>Relationship</code> or <code>RelationshipChain</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parseExpression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parses an arbitrary expression.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parseClause</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parses a full clause like <code>MATCH (m:Movie)</code> or <code>DELETE n</code> etc. These clauses might be modified via
 callbacks and then passed on into <code>org.neo4j.cypherdsl.core.Statement.of</code>. This will take them
 in order and create a whole statement out of it. It is your responsibility to make sure those clauses are
 meaningful in the given order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parseStatement</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parses a whole statement. The result can be rendered or used in a union or subquery call.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parse</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An alias for <code>parseStatement</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>README</code> for the parser module itself contains not only our whole TCK for the parser,
but also several examples of calling it. Have a look here: <a href="https://github.com/neo4j-contrib/cypher-dsl/blob/main/neo4j-cypher-dsl-parser/README.adoc">neo4j-cypher-dsl-parser/README.adoc</a>.</p>
</div>
<div class="paragraph">
<p>All the methods mention above provide an overload taking in an additional <code>org.neo4j.cypherdsl.parser.Option</code> instance
allowing to interact with the parser. Please have a look at the JavaAPI for information about the options class.
The following examples show some ways of using it.
Most of the configurable options represent ways to provide filters for labels or types or are callbacks when certain expressions are created.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cypher-parser-examples"><a class="anchor" href="#cypher-parser-examples"></a>5.3. Examples</h3>
<div class="sect3">
<h4 id="parsinguserinputandcallinasubquery"><a class="anchor" href="#parsinguserinputandcallinasubquery"></a>5.3.1. Parsing user input and call in a subquery</h4>
<div class="paragraph">
<p>This is helpful when you create an outer query that maybe enriched by a user.
Here we assume the user does the right thing and don&#8217;t modify the query any further:</p>
</div>
<div id="example-using-input" class="listingblock">
<div class="title">Listing 17. Just using the user supplied input</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var userProvidedCypher
    = <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (this)-[:LINK]-(o:Other) RETURN o as result</span><span class="delimiter">&quot;</span></span>; <i class="conum" data-value="1"></i><b>(1)</b>
var userStatement = CypherParser.parse(userProvidedCypher); <i class="conum" data-value="2"></i><b>(2)</b>

var node = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Node</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">node</span><span class="delimiter">&quot;</span></span>);
var result = Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>);
var cypher = Cypher <i class="conum" data-value="3"></i><b>(3)</b>
    .match(node)
    .call(<i class="conum" data-value="4"></i><b>(4)</b>
        userStatement,
        node.as(<span class="string"><span class="delimiter">&quot;</span><span class="content">this</span><span class="delimiter">&quot;</span></span>)
    )
    .returning(result.project(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>))
    .build()
    .getCypher();

assertThat(cypher).isEqualTo(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (node:`Node`) </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">CALL {</span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">WITH node </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">WITH node AS this </span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (this)-[:`LINK`]-(o:`Other`) RETURN o AS result</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="6"></i><b>(6)</b>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">} </span><span class="delimiter">&quot;</span></span>
    + <span class="string"><span class="delimiter">&quot;</span><span class="content">RETURN result{.foo, .bar}</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A valid standalone query that is also a valid subquery</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Just parse it into a <code>Statement</code> object</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the Cypher-DSL as explained throughout the docs</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the overload of <code>call</code> that takes a <code>Statement</code> and a collection of expression that should be imported into the subquery</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Notice how to <code>WITH</code> clauses are generated: The first one is the importing one, the second one the aliasing one</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>This is the original query</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ensureanaliasforthereturnclause"><a class="anchor" href="#ensureanaliasforthereturnclause"></a>5.3.2. Ensure an alias for the return clause</h4>
<div class="paragraph">
<p>We are going to work with the same test as in <a href="#example-using-input">Listing 17</a>, so this is not repeated.
Here we  make sure the query supplied by the user returns something with a required alias.</p>
</div>
<div id="example-required-alias" class="listingblock">
<div class="title">Listing 18. Using a callback to make sure that a query has an alias</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var userProvidedCypher = <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (this)-[:LINK]-(o:Other) RETURN o</span><span class="delimiter">&quot;</span></span>;

Function&lt;<span class="predefined-type">Expression</span>, AliasedExpression&gt; ensureAlias = r -&gt; {
    <span class="keyword">if</span> (!(r <span class="keyword">instanceof</span> AliasedExpression)) {
        <span class="keyword">return</span> r.as(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>);
    }
    <span class="keyword">return</span> (AliasedExpression) r;
}; <i class="conum" data-value="1"></i><b>(1)</b>

var options = Options.newOptions() <i class="conum" data-value="2"></i><b>(2)</b>
    .withCallback( <i class="conum" data-value="3"></i><b>(3)</b>
        ExpressionCreatedEventType.ON_RETURN_ITEM,
        AliasedExpression.class,
        ensureAlias
    )
    .build();

var userStatement = CypherParser.parse(userProvidedCypher, options); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is a <code>Function</code> that receives an expressions and returns a new one. It
checks if the provided expressions obeys to some criteria: Here being something that is aliased or not</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We start building new options</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The callback from step one is passed as callback to the event <code>ON_RETURN_ITEM</code> and will be called for every item</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The final option instance will be applied to the parser. The statement will render to the same result as <a href="#example-using-input">the first example</a>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="preventingcertainthings"><a class="anchor" href="#preventingcertainthings"></a>5.3.3. Preventing certain things</h4>
<div class="paragraph">
<p>Callbacks can of course be used to prevent things.
Any exception thrown will halt the parsing.
<a href="#example-preventing-things">Listing 19</a> shows how:</p>
</div>
<div id="example-preventing-things" class="listingblock">
<div class="title">Listing 19. Preventing input that deletes properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var userProvidedCypher = <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (this)-[:LINK]-(o:Other) REMOVE this.something RETURN o</span><span class="delimiter">&quot;</span></span>;

UnaryOperator&lt;<span class="predefined-type">Expression</span>&gt; preventPropertyDeletion = r -&gt; {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Not allowed to remove properties!</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
};

var options = Options.newOptions()
    .withCallback( <i class="conum" data-value="2"></i><b>(2)</b>
        ExpressionCreatedEventType.ON_REMOVE_PROPERTY,
        <span class="predefined-type">Expression</span>.class,
        preventPropertyDeletion
    )
    .build();

assertThatExceptionOfType(<span class="exception">RuntimeException</span>.class)
    .isThrownBy(() -&gt; CypherParser.parse(userProvidedCypher, options)); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a callback that just throws an unchecked exception</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configure it for the event that should be prevented</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Parsing will not be possible</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="shapethereturnclausethewayyouwant"><a class="anchor" href="#shapethereturnclausethewayyouwant"></a>5.3.4. Shape the return clause the way you want</h4>
<div class="paragraph">
<p>The parser provides <code>ReturnDefinition</code> as value object. It contains information to be passed to the <code>Clauses</code> factory to shape
a <code>RETURN</code> clause the way you need:</p>
</div>
<div id="example-example-shape-the-return-clause" class="listingblock">
<div class="title">Listing 20. Shaping the return clause</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var userProvidedCypher = <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (this)-[:LINK]-(o:Other) RETURN distinct this, o LIMIT 23</span><span class="delimiter">&quot;</span></span>;

Function&lt;ReturnDefinition, Return&gt; returnClauseFactory = d -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
    var finalExpressionsReturned = d.getExpressions().stream()
        .filter(e -&gt; e <span class="keyword">instanceof</span> SymbolicName &amp;&amp; <span class="string"><span class="delimiter">&quot;</span><span class="content">o</span><span class="delimiter">&quot;</span></span>.equals(((SymbolicName) e).getValue()))
        .map(e -&gt; e.as(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>))
        .collect(Collectors.&lt;<span class="predefined-type">Expression</span>&gt;toList());

    <span class="keyword">return</span> Clauses.returning(
        <span class="predefined-constant">false</span>,
        finalExpressionsReturned,
        <span class="predefined-type">List</span>.of(Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">o</span><span class="delimiter">&quot;</span></span>).property(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>).descending()),
        d.getOptionalSkip(), d.getOptionalLimit()
    );
};

var options = Options.newOptions()
    .withReturnClauseFactory(returnClauseFactory) <i class="conum" data-value="2"></i><b>(2)</b>
    .build();

var userStatement = CypherParser.parse(userProvidedCypher, options);
var cypher = userStatement.getCypher();

assertThat(cypher) <i class="conum" data-value="3"></i><b>(3)</b>
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (this)-[:`LINK`]-(o:`Other`) RETURN o AS result ORDER BY o.x DESC LIMIT 23</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a factory method that takes in a definition and uses its information to build the <code>RETURN</code>.
Or examples filters the attributes being returned and enforces an alias.
It also adds some arbitrary sorting and keeps sort and limit values from the original</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It than is parsed to the options</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The statement has the new <code>RETURN</code> clause.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="enforcinglabels"><a class="anchor" href="#enforcinglabels"></a>5.3.5. Enforcing labels</h4>
<div class="paragraph">
<p>The parser can enforce labels to be present or absent with filters. This can be individually achieved when parsing node patterns,
setting or removing labels with a <code>BiFunction</code> like the following:</p>
</div>
<div id="a-label-enforcing-functions" class="listingblock">
<div class="title">Listing 21. Shaping the return clause</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> BiFunction&lt;LabelParsedEventType, <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt;, <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt;&gt; makeSureALabelIsPresent = (e, c) -&gt; {

    var finalLabels = <span class="keyword">new</span> <span class="predefined-type">LinkedHashSet</span>&lt;&gt;(c);
    <span class="keyword">switch</span> (e) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">case</span> ON_NODE_PATTERN:
            finalLabels.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">ForcedLabel</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">return</span> finalLabels;
        <span class="keyword">case</span> ON_SET:
            finalLabels.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">Modified</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">return</span> finalLabels;
        <span class="keyword">case</span> ON_REMOVE:
            finalLabels.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">ForcedLabel</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">return</span> finalLabels;
        <span class="keyword">default</span>:
            <span class="keyword">return</span> c;
    }
};</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Decide on the event type what is supposed to happen</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Putting this function in action involves the <code>Options</code> class again:</p>
</div>
<div id="enforcing-on-parse" class="listingblock">
<div class="title">Listing 22. Enforcing a label is always set on the pattern</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var options =
    Options.newOptions().withLabelFilter(makeSureALabelIsPresent).build();
var statement = CypherParser
    .parseStatement(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:Movie) RETURN n</span><span class="delimiter">&quot;</span></span>, options)
    .getCypher();

assertThat(statement).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:`Movie`:`ForcedLabel`) RETURN n</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This can safely be used to match only nodes spotting such a label for example.</p>
</div>
<div id="enforcing-on-set" class="listingblock">
<div class="title">Listing 23. Enforcing that a new collection of labels always contains a specific</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var options =
    Options.newOptions().withLabelFilter(makeSureALabelIsPresent).build();
var statement = CypherParser
    .parseStatement(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:Movie) SET n:`Comedy` RETURN n</span><span class="delimiter">&quot;</span></span>, options)
    .getCypher();

assertThat(statement).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:`Movie`:`ForcedLabel`) SET n:`Comedy`:`Modified` RETURN n</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, we can prevent a label to be removed:</p>
</div>
<div id="enforcing-on-remove" class="listingblock">
<div class="title">Listing 24. Preventing a specific label to be removed</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var options = Options.newOptions().withLabelFilter(makeSureALabelIsPresent).build();
var statement = CypherParser
    .parseStatement(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:Movie) REMOVE n:`Comedy`:`ForcedLabel` RETURN n</span><span class="delimiter">&quot;</span></span>, options)
    .getCypher();

assertThat(statement).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:`Movie`:`ForcedLabel`) REMOVE n:`Comedy` RETURN n</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Changing relationship types via a filter is possible as well, but as relationships might only have one type, the number of
usecases is smaller.</p>
</div>
</div>
<div class="sect3">
<h4 id="combiningtheparserwithsdnscypherdslconditionexecutor"><a class="anchor" href="#combiningtheparserwithsdnscypherdslconditionexecutor"></a>5.3.6. Combining the parser with SDN&#8217;s <code>CypherdslConditionExecutor</code></h4>
<div class="paragraph">
<p>Spring Data Neo4j 6 provides <code>CypherdslConditionExecutor</code>. This is a fragment that adds the capability to execute
statements with added conditions to a <code>Neo4jRepository</code>.</p>
</div>
<div class="paragraph">
<p>Given the following repository:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.data.neo4j.repository.Neo4jRepository</span>;
<span class="keyword">import</span> <span class="include">org.springframework.data.neo4j.repository.support.CypherdslConditionExecutor</span>;
<span class="keyword">import</span> <span class="include">org.springframework.data.neo4j.repository.support.CypherdslStatementExecutor</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">PeopleRepository</span> <span class="directive">extends</span> Neo4jRepository&lt;Person, <span class="predefined-type">Long</span>&gt;,
    CypherdslConditionExecutor&lt;Person&gt;, <i class="conum" data-value="1"></i><b>(1)</b>
    CypherdslStatementExecutor&lt;Person&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allows to just add conditions to our generated queries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Provides an alternative to using @Query with strings</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One possible use case is presented in this service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Iterable</span>&lt;Person&gt; findPeopleBornAfterThe70tiesAnd(<span class="predefined-type">String</span> additionalConditions) {

    <span class="keyword">return</span> peopleRepository.findAll(
        PERSON.BORN.gte(Cypher.literalOf(<span class="integer">1980</span>))
            .and(CypherParser.parseExpression(additionalConditions).asCondition()) <i class="conum" data-value="1"></i><b>(1)</b>
    );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The condition that only people born later than 1980 is hard coded in the service.
An arbitrary String is than parsed into a condition and attached via <code>AND</code>.
Thus, only valid cypher can go in there and with filters and callbacks, preconditions of that Cypher can be asserted.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The downside to the above solution is that the query fragment passed to the service and eventually the repository must
know the root node (which is <code>n</code> in case of SDN 6) and the caller code might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var exchange = restTemplate.exchange(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/api/people/v1/findPeopleBornAfterThe70ties?conditions={conditions}</span><span class="delimiter">&quot;</span></span>,
    HttpMethod.GET,
    <span class="predefined-constant">null</span>, <span class="keyword">new</span> ParameterizedTypeReference&lt;<span class="predefined-type">List</span>&lt;Person&gt;&gt;() { },
    <span class="string"><span class="delimiter">&quot;</span><span class="content">n.name contains </span><span class="char">\&quot;</span><span class="content">Ricci</span><span class="char">\&quot;</span><span class="content"> OR n.name ends with 'Hirsch'</span><span class="delimiter">&quot;</span></span>
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice <code>n.name</code> etc.
We could change the service method slightly and apply a callback like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Iterable</span>&lt;Person&gt; findPeopleBornAfterThe70tiesAndV2(<span class="predefined-type">String</span> additionalConditions) {

    Function&lt;<span class="predefined-type">Expression</span>, <span class="predefined-type">Expression</span>&gt; enforceReference =
        e -&gt; Constants.NAME_OF_ROOT_NODE.property(((SymbolicName) e).getValue()); <i class="conum" data-value="1"></i><b>(1)</b>
    var parserOptions = Options.newOptions()
        .withCallback(
            ExpressionCreatedEventType.ON_NEW_VARIABLE,
            <span class="predefined-type">Expression</span>.class,
            enforceReference
        ) <i class="conum" data-value="2"></i><b>(2)</b>
        .build();

    <span class="keyword">return</span> peopleRepository.findAll(
        PERSON.BORN.gte(Cypher.literalOf(<span class="integer">1980</span>)).and(
            CypherParser.parseExpression(
                additionalConditions,
                parserOptions <i class="conum" data-value="3"></i><b>(3)</b>
            ).asCondition()
        )
    );
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a function that takes the value of a variable created in the fragment and use it to look up a property on the
SDN root node.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create an instance of parsing options. It&#8217;s probably a good idea todo this once and store them away in an instance variable.
Options are thread safe.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Apply them when calling the corresponding parse method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now it&#8217;s enough to pass <code>"name contains \"Ricci\" OR name ends with 'Hirsch'"</code> into the exchange presented above and things
will work out of the box.
Further validation and sanitiy checks are of course up to you.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="driver-integration"><a class="anchor" href="#driver-integration"></a>6. Integration with the Neo4j-Java-Driver</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="introduction3"><a class="anchor" href="#introduction3"></a>6.1. Introduction</h3>
<div class="paragraph">
<p>The Cypher-DSL is - apart from <a href="https://github.com/apiguardian-team/apiguardian">API Guardian</a> - dependency free.
It has however some optional dependency you can add to use more functionality.
One of those dependencies is the <a href="https://github.com/neo4j/neo4j-java-driver">Neo4j-Java-Driver</a>.
The Neo4j-Java-Driver - or sometimes Bolt for Java or Bolt-Driver - implements Neo4j&#8217;s Bolt protocol
and provides a connection to a single Neo4j instance or a cluster.</p>
</div>
<div class="paragraph">
<p>While the Cypher-DSL creates statements that eventually will be rendered as a <code>String</code>, it has some knowledge about the
statements generated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Will the statements return something?</p>
</li>
<li>
<p>Or will the statements just run updates?</p>
</li>
<li>
<p>Will the statements be profiled?</p>
</li>
<li>
<p>Do the statements carry parameter definitions and values for parameters?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can use that knowledge to provide a thin shim for using the Cypher-DSL with the API the Neo4j-Java-Driver provides
without reinventing the wheel.</p>
</div>
<div class="paragraph">
<p>In most cases the Cypher-DSL will generate one of two types of statements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.neo4j.cypherdsl.core.Statement</code>: A statement without a result. It can be executed, but it cannot be fetched.
You will be able to check for the number of affected database entities via the driver&#8217;s <code>ResultSummary</code>.</p>
</li>
<li>
<p><code>org.neo4j.cypherdsl.core.ResultStatement</code>: A statement known to have a result. It can be executed or fetched.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both interfaces can be turned into <em>ExecutableStatements</em>, providing the appropriate methods, which will be discussed below.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This API is not required to use the driver nor is the driver required for using the Cypher-DSL.
      The main API provided with the Cypher-DSL is <code>Statement#getCypher()</code> for retrieving a Cypher-String and optional call
      to <code>Statement#getParameters()</code> to retrieve parameters stored with the statement.
     <br>
      Those can be used in many ways and forms with the Neo4j-Java-Driver or mapping frameworks like
      Neo4j-OGM or Spring Data Neo4j 6+.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="addadditionaldependencies2"><a class="anchor" href="#addadditionaldependencies2"></a>6.2. Add additional dependencies</h3>
<div class="listingblock">
<div class="title">Listing 25. Neo4j-Java-Driver added via Maven</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.neo4j.driver<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>neo4j-java-driver<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>4.2.7<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Any 4.x version of the Driver will work, we currently test against 4.2.7.
In case you want to use our integration with reactive sessions, you will have to add <a href="https://projectreactor.io">Project Reactor</a>.
To the outside world we expose - much like the driver - the vendor agnostic <a href="https://www.reactive-streams.org">Reactive Streams spec</a>.</p>
</div>
<div class="paragraph">
<p>The coordinates of Project reactor are <code>io.projectreactor:reactor-core</code>. Those can be added in the appropriate form to a
Maven or Gradle project.
We test with 2020.0.6 of Reactor and use their BOM module imported into dependency management instead of a fixed
version for the core module itself:</p>
</div>
<div class="listingblock">
<div class="title">Listing 26. Optional Project reactor dependencies.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>io.projectreactor<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>reactor-bom<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>2020.0.6<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="imperative-api"><a class="anchor" href="#imperative-api"></a>6.3. Imperative (blocking) API</h3>
<div class="paragraph">
<p>You create an instance of the Neo4j driver.
This instance should be a long living instance in your application:</p>
</div>
<div class="listingblock">
<div class="title">Listing 27. Create a driver instance</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">driver = GraphDatabase.driver(neo4j.getBoltUrl(), AuthTokens.basic(<span class="string"><span class="delimiter">&quot;</span><span class="content">neo4j</span><span class="delimiter">&quot;</span></span>, neo4j.getAdminPassword()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>org.neo4j.driver.Session</code> and <code>org.neo4j.driver.Transaction</code> implement a <code>QueryRunner</code> (the same applies for the
reactive variants).
It is your responsibility to pick the right kind of interaction with the database (auto commit, transactions or transactional functions).
If you pass a <code>Session</code> to the Cypher-DSL, auto commit transactions will be used. If you pass in a transaction object,
unmanaged transactions will be used and you must commit or rollback as needed and take care for retries.</p>
</div>
<div class="paragraph">
<p>A safe bet is to pass one of the Cypher-DSL methods to the driver as a READ or WRITE transaction.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Cypher-DSL won&#8217;t close, commit or rollback anything you pass to it. You open resources, you close them. In all
     cases where the Cypher-DSL opens or provides a resource, it will take care closing it correctly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Our goal when writing this small integration with the official driver was to apply best practices when working with the
driver without adding too much cognitive overhead or introducing new types.</p>
</div>
<div class="sect3">
<h4 id="executingstatements"><a class="anchor" href="#executingstatements"></a>6.3.1. Executing statements</h4>
<div class="paragraph">
<p>We first have a look at statements that don&#8217;t return data, but may execute updates or call stored procedures.
We will use <a href="#statement-without-result">the following listing</a> as example:</p>
</div>
<div id="statement-without-result" class="listingblock">
<div class="title">Listing 28. Example statement that does not return any data.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var m = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);
var statement = ExecutableStatement.of(Cypher.create(m)
    .set(m.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).to(Cypher.anonParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">statementWithoutResult</span><span class="delimiter">&quot;</span></span>)))
    .build());</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="insidetransactionalfunctions"><a class="anchor" href="#insidetransactionalfunctions"></a>Inside transactional functions</h5>
<div class="paragraph">
<p>The driver has the concept of <em>transactional functions</em>. This basically describes a transaction manager understanding the
semantics of a Neo4j cluster, possible errors that can occur, routing and such.
The transaction manager is able to retry statements in certain error cases.</p>
</div>
<div class="paragraph">
<p>Transactional functions are passed as <code>TransactionalWork&lt;T&gt;</code> to a session.
The <code>executeWith</code> API on <code>Statement</code> fits this interface and you can pass it as a method reference.
It will always return a result summary:</p>
</div>
<div id="statement-without-result-tx-function" class="listingblock">
<div class="title">Listing 29. Executing statements in a managed transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (var session = driver.session()) { <i class="conum" data-value="1"></i><b>(1)</b>
    var summary = session.writeTransaction(statement::executeWith); <i class="conum" data-value="2"></i><b>(2)</b>
    assertThat(summary.counters().nodesCreated()).isEqualTo(<span class="integer">1</span>); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Open a session</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass the <code>executeWith</code> method from the Cypher-DSL statement to the driver</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Do something with the result summary</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read more about transactional functions in the official manual: <a href="https://neo4j.com/docs/driver-manual/4.0/session-api/configuration/#driver-simple-transaction-fn">Imperative sessions and transaction functions</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="withanunmanagedtransaction"><a class="anchor" href="#withanunmanagedtransaction"></a>With an unmanaged transaction</h5>
<div class="paragraph">
<p>A transaction you retrieve from a session is called unmanaged transaction.
It is your responsibility to commit or rollback and close it.</p>
</div>
<div id="statement-without-result-unmanaged-tx" class="listingblock">
<div class="title">Listing 30. Executing statements in an unmanaged transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (var session = driver.session();
    var tx = session.beginTransaction() <i class="conum" data-value="1"></i><b>(1)</b>
) {
    var summary = statement.executeWith(tx); <i class="conum" data-value="2"></i><b>(2)</b>
    tx.commit(); <i class="conum" data-value="3"></i><b>(3)</b>

    assertThat(summary.counters().nodesCreated()).isEqualTo(<span class="integer">1</span>);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get a transaction from the session</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass it to the statement, execute and get the result summary</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Do more things in the transaction, than commit or rollback it</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The advantage here is that you have more control and are not limited to idempotent operations for the transactional function.
The disadvantage has been hidden away in that example: You have to take care of exceptions that might happen due to cluster
errors yourself.</p>
</div>
<div class="paragraph">
<p>If you want to use an auto-commit transaction (for example for a <code>PERIODIC COMMIT</code> or an APOC call), just pass a <code>Session</code>
to <code>executeWith</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fetchingdata"><a class="anchor" href="#fetchingdata"></a>6.3.2. Fetching data</h4>
<div class="paragraph">
<p>The following examples will use this statement, returning the title of movies in the Movie-Graph:</p>
</div>
<div id="statement-with-result" class="listingblock">
<div class="title">Listing 31. Example statement that does return data.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var m = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);
var statement = ExecutableStatement.of(Cypher.match(m)
    .returning(m.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>)).build());</code></pre>
</div>
</div>
<div class="paragraph">
<p>We provide two forms of accessing data via the imperative API: Pulling everything into a list or streaming records.
The <a href="#reactive-api">reactive API</a> is fully non-blocking and uses a publishing API.</p>
</div>
<div class="sect4">
<h5 id="insidetransactionalfunctions2"><a class="anchor" href="#insidetransactionalfunctions2"></a>Inside transactional functions</h5>
<div id="statement-with-result-tx-function" class="listingblock">
<div class="title">Listing 32. Fetching statements in a managed transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (var session = driver.session()) { <i class="conum" data-value="1"></i><b>(1)</b>

    var moviesTitles = session.readTransaction(statement::fetchWith) <i class="conum" data-value="2"></i><b>(2)</b>
        .stream() <i class="conum" data-value="3"></i><b>(3)</b>
        .map(r -&gt; r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).asString())
        .collect(Collectors.toList());

    assertMovieTitleList(moviesTitles);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Open a session</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass the <code>fetchWith</code> method from the Cypher-DSL statement to the driver</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>readTransaction</code> (or <code>writeTransaction</code>) returns whatever the transactional work returns
Our transactional work <code>fetchWith</code> returns a <code>java.util.List</code> of records
Here we turn it into a Java stream (not connected to Neo4j) and map and collect it</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>fetchWith</code> does support a second parameter, a mapping function <code>Function&lt;Record, T&gt; mappingFunction</code>. We can use this
with a transactional function as well and do the mapping inside the transaction.
For the example, this form here is easier to read, but the other one may have benefits in regards of memory allocation.</p>
</div>
<div class="paragraph">
<p>You also can stream the result. In contrast to the plain Driver API, we don&#8217;t hand out the stream itself but expect a
closure dealing with the stream. We do this to make it impossible to use the stream - which is still connected to the database -
outside the transaction. With managed transactions, it looks like this:</p>
</div>
<div id="statement-with-result-tx-function-stream" class="listingblock">
<div class="title">Listing 33. Streaming statements in a managed transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (var session = driver.session()) { <i class="conum" data-value="1"></i><b>(1)</b>

    var summary = session.readTransaction(tx -&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        statement.streamWith(tx, s -&gt; { <i class="conum" data-value="3"></i><b>(3)</b>
            var moviesTitles = s.map(r -&gt; r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).asString())
                .collect(Collectors.toList()); <i class="conum" data-value="4"></i><b>(4)</b>
            assertMovieTitleList(moviesTitles);
        })
    );
    assertThat(summary.query().text()).isEqualTo(statement.getCypher());
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Open a session</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Open a managed transaction, but don&#8217;t pass a method reference this time</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Instead, call <code>streamWith</code>, pass the transaction and a consumer for the stream <code>s</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Inside this example, we fully materialize the stream and map records as they pass by
As the streaming method will always return the result summary, this will also be the type of the transaction function</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="withanunmanagedtransaction2"><a class="anchor" href="#withanunmanagedtransaction2"></a>With an unmanaged transaction</h5>
<div class="paragraph">
<p>Now the same examples with unmanaged transactions. First, listening them. Here we pass a mapping function directly to <code>fetchWith</code>.
The pattern of opening a session and transaction is the same as before.</p>
</div>
<div id="statement-with-result-unmanaged-tx" class="listingblock">
<div class="title">Listing 34. Listening results with an unmanaged transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (var session = driver.session();
    var tx = session.beginTransaction()) {

    var moviesTitles = statement.fetchWith(
        tx, <i class="conum" data-value="1"></i><b>(1)</b>
        r -&gt; r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).asString() <i class="conum" data-value="2"></i><b>(2)</b>
    );
    tx.commit();

    assertMovieTitleList(moviesTitles);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The unmanaged transaction passed to the statement,</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>and the mapping function applied. <code>moviesTitle</code> is a <code>List</code> containing <code>String</code> elements in the end.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The streaming example looks pretty similar to the one applied with the transactional function.
As we pass the <code>Session</code> object itself, we are using an auto-commit transaction.</p>
</div>
<div id="statement-with-result-auto-commit-stream" class="listingblock">
<div class="title">Listing 35. Streaming results with an auto-commit-transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (var session = driver.session()) {

    var summary = statement.streamWith(session, stream -&gt; {
        var moviesTitles = stream
            .map(r -&gt; r.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).asString())
            .collect(Collectors.toList());
        assertMovieTitleList(moviesTitles);
    });
    assertThat(summary.query().text()).isEqualTo(statement.getCypher());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, please note that the stream is only available in the closure. It is not meant to live outside the transactional scope.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reactive-api"><a class="anchor" href="#reactive-api"></a>6.4. Reactive API</h3>
<div class="paragraph">
<p>For the reactive API the variants inside a transactional function are focused here as they are probably the most complex
ones to get right: You have to deal with to resources: The session itself, and the inner publisher returned from the transactional
function.</p>
</div>
<div class="paragraph">
<p>To create a reactive, executable statement from either a <code>Statement</code> or <code>ResultStatement</code> use the factory methods from <code>ReactiveExecutableStatement</code>:</p>
</div>
<div id="create-statement-without-result" class="listingblock">
<div class="title">Listing 36. Reactive Example statement that does not return any data.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var m = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);
var statement = ReactiveExecutableStatement.of(Cypher.create(m)
    .set(m.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).to(Cypher.anonParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">statementsWithoutResultReactive</span><span class="delimiter">&quot;</span></span>)))
    .build());</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="executingstatements2"><a class="anchor" href="#executingstatements2"></a>6.4.1. Executing statements</h4>
<div class="paragraph">
<p>The most important part in the following example is not necessarily our API, but the use of Reactors <code>fromDirect</code> operator when converting
a publisher of a single element into a <code>Mono</code>: That operator trusts the user that the publisher will return zero or one element
and doesn&#8217;t cancel after the first item being emitted and thus rolling back the transaction:</p>
</div>
<div id="statement-without-result-tx-function-reactive-stream" class="listingblock">
<div class="title">Listing 37. Reactive streaming results with an managed transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Mono.usingWhen(
    Mono.fromSupplier(driver::rxSession), <i class="conum" data-value="1"></i><b>(1)</b>
    s -&gt; Mono.fromDirect(s.writeTransaction(statement::executeWith)), <i class="conum" data-value="2"></i><b>(2)</b>
    RxSession::close <i class="conum" data-value="3"></i><b>(3)</b>
).as(StepVerifier::create)
    .expectNextMatches(r -&gt; r.counters().nodesCreated() == <span class="integer">1</span>) <i class="conum" data-value="4"></i><b>(4)</b>
    .verifyComplete();</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The session should be opened non-blocking and as late as possible</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is the actual call from the Cypher-DSL into the driver</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Closed what you opened</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The reactive <code>executeWith</code>-variant returns the summary as well</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="fetchingresults"><a class="anchor" href="#fetchingresults"></a>6.4.2. Fetching results</h4>
<div class="sect4">
<h5 id="withareactivetransactionalfunction"><a class="anchor" href="#withareactivetransactionalfunction"></a>With a reactive, transactional function</h5>
<div class="paragraph">
<p>This example uses our original statement and arbitrary skips 2 elements and then takes only 30 elements.
As the transaction is managed by the driver, canceling the publisher via <code>take()</code> won&#8217;t rollback the transaction.</p>
</div>
<div id="statement-with-result-tx-function-reactive-stream" class="listingblock">
<div class="title">Listing 38. Reactive streaming results with an managed transaction</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Flux.usingWhen(
    Mono.fromSupplier(driver::rxSession),
    s -&gt; s.readTransaction(statement::fetchWith),
    RxSession::close
)
    .skip(<span class="integer">2</span>)
    .take(<span class="integer">30</span>)
    .as(StepVerifier::create)
    .expectNextCount(<span class="integer">30</span>)
    .verifyComplete();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="insideanauto-committransaction"><a class="anchor" href="#insideanauto-committransaction"></a>Inside an auto-commit transaction</h5>
<div class="paragraph">
<p>One use case might be the bulk loading of data.
By using an auto-commit transaction we effectively state that we neither manage a transaction ourselves nor we want the driver
to manage one for us.
In this case we use Neo4j&#8217;s <code>LOAD CSV</code> clause that basically describes a Cypher script that runs in its own transaction.
The server might or might not start streaming results after the configured periodic commit rate has been hit:</p>
</div>
<div id="periodic-commit-statement" class="listingblock">
<div class="title">Listing 39. Using <code>PERIODIC COMMIT LOAD CSV</code> from a reactive auto-commit transaction:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var row = Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">row</span><span class="delimiter">&quot;</span></span>);
var a = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Author</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, Functions.trim(Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>))).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
var m = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Book</span><span class="delimiter">&quot;</span></span>).withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, row.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">Title</span><span class="delimiter">&quot;</span></span>)).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>);

var statement = ReactiveExecutableStatement.of(Cypher.usingPeriodicCommit(<span class="integer">10</span>)
    .loadCSV(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:///books.csv</span><span class="delimiter">&quot;</span></span>), <span class="predefined-constant">true</span>).as(row).withFieldTerminator(<span class="string"><span class="delimiter">&quot;</span><span class="content">;</span><span class="delimiter">&quot;</span></span>)
    .create(m)
    .with(m.getRequiredSymbolicName(), row)
    .unwind(Functions.split(row.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">Authors</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">&amp;</span><span class="delimiter">&quot;</span></span>)).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>)
    .merge(a)
    .create(a.relationshipTo(m, <span class="string"><span class="delimiter">&quot;</span><span class="content">WROTE</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>))
    .returningDistinct(m.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
    .build());

Flux.using(driver::rxSession, statement::fetchWith, RxSession::close)
    .as(StepVerifier::create)
    .expectNextCount(<span class="integer">50</span>)
    .verifyComplete();</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="static-meta-model"><a class="anchor" href="#static-meta-model"></a>7. Building a static meta model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="concepts"><a class="anchor" href="#concepts"></a>7.1. Concepts</h3>
<div class="sect3">
<h4 id="astaticmetamodelisoptional"><a class="anchor" href="#astaticmetamodelisoptional"></a>7.1.1. A static meta model is optional</h4>
<div class="paragraph">
<p>First let&#8217;s stress this: a static meta model is optional for the Cypher-DSL. It is completely OK to use the Cypher-DSL
as shown in the <a href="#how-to-use-it.examples">examples in the "How to use it" part</a>:
all labels, types and properties can be named as you go.
The Cypher-DSL will still give you type-safety in regard to the Cypher&#8217;s syntax.</p>
</div>
<div class="paragraph">
<p>This fits nicely with Neo4j&#8217;s capabilities: Neo4j is a schemaless database. Nodes, their relationships between each other,
their labels and properties can be changed as you go but all of this information can still be queried.</p>
</div>
<div class="paragraph">
<p>In a schemaless database or a database with dynamic scheme the scheme is often defined by the application.
This definition takes many forms: It can be through an object mapper like <a href="https://github.com/neo4j/neo4j-ogm">Neo4j-OGM</a> or
<a href="https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#reference">Spring Data Neo4j 6+</a>, or maybe in form of
Graph-QL schemes.</p>
</div>
<div class="paragraph">
<p>Another source may be the information we can retrieve from the database itself via <a href="https://neo4j.com/docs/operations-manual/current/reference/procedures/#procedure_db_schema_nodetypeproperties"><code>db.schema.nodeTypeProperties</code></a> and
<a href="https://neo4j.com/docs/operations-manual/current/reference/procedures/#procedure_db_schema_reltypeproperties"><code>db.schema.relTypeProperties</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="static-meta-model.building-blocks"><a class="anchor" href="#static-meta-model.building-blocks"></a>7.1.2. Building blocks</h4>
<div class="paragraph">
<p>The Cypher DSL offers the following building blocks as part of the public API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Two pattern elements:</p>
<div class="ulist">
<ul>
<li>
<p>Nodes via <code>Node</code> (and its default implementation <code>NodeBase</code>)</p>
</li>
<li>
<p>Relationships via <code>Relationship</code> (and its default implementation <code>RelationshipBase</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Property</code>, which is a holder for properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you use Cypher-DSL like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var m = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);
var statement = Cypher.match(m).returning(m).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>m</code> will be a <code>Node</code> instance having the label <code>Movie</code> and an alias of <code>m</code>. <code>m</code> can be used everywhere where a pattern element
can be used according to the openCypher spec.
You don&#8217;t have to care about its type. That&#8217;s why we vouched for the JDK11+ local type inference here and omitted the
declaration of the type <code>Node</code>: it just reads better.</p>
</div>
</div>
<div class="sect3">
<h4 id="averysimplestaticmodel"><a class="anchor" href="#averysimplestaticmodel"></a>7.1.3. A very simple, static model</h4>
<div class="paragraph">
<p>Both <code>NodeBase</code> and  <code>RelationshipBase</code> are meant to be extended to put your static model into something that is usable
with the Cypher-DSL.</p>
</div>
<div class="sect4">
<h5 id="nodes"><a class="anchor" href="#nodes"></a>Nodes</h5>
<div class="paragraph">
<p>Start by extending <code>NodeBase</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.MapExpression</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.NodeBase</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.NodeLabel</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Properties</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.SymbolicName</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Movie</span> <span class="directive">extends</span> NodeBase&lt;Movie&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> Movie MOVIE = <span class="keyword">new</span> Movie(); <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">public</span> Movie() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="directive">private</span> Movie(SymbolicName symbolicName, <span class="predefined-type">List</span>&lt;NodeLabel&gt; labels, <span class="predefined-type">Properties</span> properties) { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="local-variable">super</span>(symbolicName, labels, properties);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Movie named(SymbolicName newSymbolicName) { <i class="conum" data-value="5"></i><b>(5)</b>

        <span class="keyword">return</span> <span class="keyword">new</span> Movie(newSymbolicName, getLabels(), getProperties());
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Movie withProperties(MapExpression newProperties) { <i class="conum" data-value="6"></i><b>(6)</b>

        <span class="keyword">return</span> <span class="keyword">new</span> Movie(getSymbolicName().orElse(<span class="predefined-constant">null</span>), getLabels(), <span class="predefined-type">Properties</span>.create(newProperties));
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extend from <code>NodeBase</code> and specify your class as a "self" type-argument</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional: Create one static instance of your model</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This is where you specify one or more label</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>This constructor is optional, it is used in the next two steps</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>named</code> must be overridden and must return new copies of the node, with the changed symbolic name.
It must be overridden to guarantee type integrity.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Same as above</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With that in place, you can already use it like this:</p>
</div>
<div id="static-movie" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var cypher = Cypher.match(Movie.MOVIE)
    .returning(Movie.MOVIE)
    .build().getCypher();</code></pre>
</div>
</div>
<div class="paragraph">
<p>and it would generate a Cypher string like this: <code>"MATCH (jwKyXzwS000:`Movie</code>) RETURN jwKyXzwS000"`, with generated variable names.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t like them, you can just rename one instance of the movie-model like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var movie = Movie.MOVIE.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);
var cypher = Cypher.match(movie)
    .returning(movie)
    .build().getCypher();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, properties belong into a model as well. You add them like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Property</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Movie</span> <span class="directive">extends</span> NodeBase&lt;Movie&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> <span class="directive">final</span> Property TITLE = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Same class before, extending from <code>NodeBase</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use <code>this</code> and the <code>property</code> method to create a new <code>Property</code> instance, stored on the given instance</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A possible usage scenario looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var movie = Movie.MOVIE.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);
var cypher = Cypher.match(movie)
    .where(movie.TITLE.isEqualTo(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">The Matrix</span><span class="delimiter">&quot;</span></span>))) <i class="conum" data-value="1"></i><b>(1)</b>
    .returning(movie)
    .build().getCypher();

Assertions.assertThat(cypher)
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (m:`Movie`) WHERE m.title = 'The Matrix' RETURN m</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make sure to use the renamed instance everywhere. Here: For accessing the property. Alternatively, don&#8217;t rename.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="relationships"><a class="anchor" href="#relationships"></a>Relationships</h5>
<div class="paragraph">
<p>Relationships are a bit more complicated. Relationships of the same type can be used between nodes with different labels.
We have these scenarios:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>(s:LabelA) - (r:SomeType) &#8594; (e:LabelB)</code>:</p>
</li>
<li>
<p><code>(s:LabelA) - (r:SomeType) &#8594; (e)</code></p>
</li>
<li>
<p><code>(s) - (r:SomeType) &#8594; (e)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We either have a type that is used only between the same set of labels, or a type is used always with one fixed label or
a type is used between arbitrary labels.</p>
</div>
<div class="paragraph">
<p>To accommodate for that, the default relationship implementation, <code>RelationshipBase</code>, spots three type parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">RelationshipBase</span>&lt;S <span class="directive">extends</span> NodeBase&lt;?&gt;, E <span class="directive">extends</span> NodeBase&lt;?&gt;, SELF <span class="directive">extends</span> RelationshipBase&lt;S, E, SELF&gt;&gt; {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>S</code> is the type of a start node, <code>E</code> of an end node and <code>SELF</code> is the concrete implementation itself.
The public API of <code>RelationshipBase</code> enforces a direction from start to end (<code>LTR</code>, left to right).</p>
</div>
<div class="paragraph">
<p>We just have a look at the first case to make the concepts clear. We model the <code>ACTED_IN</code> relationship of the movie graph.
It exists between people and movies (going from person to movie) and has an attribute roles:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.MapExpression</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Node</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Properties</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Property</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.RelationshipBase</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.SymbolicName</span>;

<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">ActedIn</span> <span class="directive">extends</span> RelationshipBase&lt;Person, Movie, ActedIn&gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> <span class="error">$</span>TYPE = <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> <span class="directive">final</span> Property ROLE = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">protected</span> ActedIn(Person start, Movie end) {
        <span class="local-variable">super</span>(start, <span class="error">$</span>TYPE, end); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="directive">private</span> ActedIn(SymbolicName symbolicName, Node start, <span class="predefined-type">Properties</span> properties, Node end) { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="local-variable">super</span>(symbolicName, start, <span class="error">$</span>TYPE, properties, end);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ActedIn named(SymbolicName newSymbolicName) { <i class="conum" data-value="5"></i><b>(5)</b>

        <span class="keyword">return</span> <span class="keyword">new</span> ActedIn(newSymbolicName, getLeft(), getDetails().getProperties(), getRight());
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ActedIn withProperties(MapExpression newProperties) { <i class="conum" data-value="6"></i><b>(6)</b>

        <span class="keyword">return</span> <span class="keyword">new</span> ActedIn(getSymbolicName().orElse(<span class="predefined-constant">null</span>), getLeft(), <span class="predefined-type">Properties</span>.create(newProperties), getRight());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The base class, with 3 concrete types. A <code>Person</code>, the <code>Movie</code> from <a href="#static-movie">[static-movie]</a> and the type itself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Same idea with as with nodes: Store all properties as final attributes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>There is no default constructor for a relationship: Start and end node must be specified. The type is fixed.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Copy constructor for the following two methods</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Required to rename this relationship</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Required for querying properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In contrast to the movie, we don&#8217;t need a static attribute allowing access to the relationship.
This is stored at the owner. In this case, the <code>Person</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Person</span> <span class="directive">extends</span> NodeBase&lt;Person&gt; {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> Person PERSON = <span class="keyword">new</span> Person();

    <span class="directive">public</span> <span class="directive">final</span> Directed&lt;Movie&gt; DIRECTED = <span class="keyword">new</span> Directed&lt;&gt;(<span class="local-variable">this</span>, Movie.MOVIE);

    <span class="directive">public</span> <span class="directive">final</span> ActedIn ACTED_IN = <span class="keyword">new</span> ActedIn(<span class="local-variable">this</span>, Movie.MOVIE); <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">public</span> <span class="directive">final</span> Property NAME = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="directive">final</span> Property FIRST_NAME = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="directive">final</span> Property BORN = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">born</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We create the relationship properties with <code>this</code> concrete instance pointing to another, concrete instance.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="summary2"><a class="anchor" href="#summary2"></a>7.1.4. Summary</h4>
<div class="paragraph">
<p>While there are possible other ways to define a static meta model with the Cypher-DSL, this is the way we create them with
the <code>neo4j-cypher-dsl-codegen</code> models.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="possibleusage"><a class="anchor" href="#possibleusage"></a>7.2. Possible Usage</h3>
<div class="paragraph">
<p>Please assume we did model the "Movie graph" (<code>:play movies</code> in Neo4j-Browser) with the following scheme:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/movie-graph.png" alt="movie graph">
</div>
</div>
<div class="paragraph">
<p>and these classes, which have been generated with the
<a href="#static-meta-model.building-blocks">building blocks described earlier</a> (the required functions have been omitted for brevity):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> <span class="type">class</span> <span class="class">Movie</span> <span class="directive">extends</span> NodeBase&lt;Movie&gt; {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> Movie MOVIE = <span class="keyword">new</span> Movie();

    <span class="directive">public</span> <span class="directive">final</span> Property TAGLINE = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">tagline</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="directive">final</span> Property TITLE = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="directive">final</span> Property RELEASED = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">released</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> Movie() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Movie</span><span class="delimiter">&quot;</span></span>);
    }
}

<span class="directive">final</span> <span class="type">class</span> <span class="class">Person</span> <span class="directive">extends</span> NodeBase&lt;Person&gt; {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> Person PERSON = <span class="keyword">new</span> Person();

    <span class="directive">public</span> <span class="directive">final</span> Property NAME = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="directive">final</span> Property FIRST_NAME = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> <span class="directive">final</span> Directed&lt;Movie&gt; DIRECTED = <span class="keyword">new</span> Directed&lt;&gt;(<span class="local-variable">this</span>, Movie.MOVIE);

    <span class="directive">public</span> <span class="directive">final</span> ActedIn ACTED_IN = <span class="keyword">new</span> ActedIn(<span class="local-variable">this</span>, Movie.MOVIE);

    <span class="directive">public</span> <span class="directive">final</span> Property BORN = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">born</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">public</span> Person() {
        <span class="local-variable">super</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>);
    }
}

<span class="directive">final</span> <span class="type">class</span> <span class="class">ActedIn</span> <span class="directive">extends</span> RelationshipBase&lt;Person, Movie, ActedIn&gt; {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> <span class="error">$</span>TYPE = <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTED_IN</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">public</span> <span class="directive">final</span> Property ROLE = <span class="local-variable">this</span>.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">protected</span> ActedIn(Person start, Movie end) {
        <span class="local-variable">super</span>(start, <span class="error">$</span>TYPE, end);
    }
}

<span class="directive">final</span> <span class="type">class</span> <span class="class">Directed</span>&lt;E <span class="directive">extends</span> NodeBase&lt;?&gt;&gt; <span class="directive">extends</span> RelationshipBase&lt;Person, E, Directed&lt;E&gt;&gt; {

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> <span class="error">$</span>TYPE  = <span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTED</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">protected</span> Directed(Person start, E end) {
        <span class="local-variable">super</span>(start, <span class="error">$</span>TYPE, end);
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="workwithproperties"><a class="anchor" href="#workwithproperties"></a>7.2.1. Work with properties</h4>
<div class="paragraph">
<p>Properties can be used like normal objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var cypher = Cypher.match(Person.PERSON)
    .returning(Person.PERSON.NAME, Person.PERSON.BORN)
    .build().getCypher();

Assertions.assertThat(cypher)
    .matches(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH </span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">w+:`Person`</span><span class="char">\\</span><span class="content">) RETURN </span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.name, </span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.born</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, new properties can be derived:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var cypher = Cypher.match(Person.PERSON)
    .returning(Person.PERSON.NAME.concat(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content"> whatever</span><span class="delimiter">&quot;</span></span>)))
    .build().getCypher();

Assertions.assertThat(cypher)
    .matches(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH </span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">w+:`Person`</span><span class="char">\\</span><span class="content">) RETURN </span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">w+</span><span class="char">\\</span><span class="content">.name </span><span class="char">\\</span><span class="content">+ ' whatever'</span><span class="char">\\</span><span class="content">)</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="querynodesorrelationshipsbyproperties"><a class="anchor" href="#querynodesorrelationshipsbyproperties"></a>7.2.2. Query nodes or relationships by properties</h4>
<div class="paragraph">
<p>Use <code>withProperties</code> (and <code>named</code> you like) to model your queries as needed.
Applicable to properties of nodes such as the title:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var movie = Movie.MOVIE.withProperties(Movie.MOVIE.TITLE, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">The Matrix</span><span class="delimiter">&quot;</span></span>)).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">m1</span><span class="delimiter">&quot;</span></span>);
var cypher = Cypher.match(movie)
    .returning(movie)
    .build().getCypher();

Assertions.assertThat(cypher)
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (m1:`Movie` {title: 'The Matrix'}) RETURN m1</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>and relationships:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var actedIn = Person.PERSON.ACTED_IN.withProperties(Person.PERSON.ACTED_IN.ROLE, Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Neo</span><span class="delimiter">&quot;</span></span>));
var cypher = Cypher.match(actedIn)
    .returning(Movie.MOVIE)
    .build().getCypher();

Assertions.assertThat(cypher)
    .matches(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH </span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">w+:`Person`</span><span class="char">\\</span><span class="content">)-</span><span class="char">\\</span><span class="content">[</span><span class="char">\\</span><span class="content">w+:`ACTED_IN` </span><span class="char">\\</span><span class="content">{role: 'Neo'}]-&gt;</span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">w+:`Movie`</span><span class="char">\\</span><span class="content">) RETURN </span><span class="char">\\</span><span class="content">w+</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the query will look like this, as we didn&#8217;t rename the objects and they used generated names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">`MATCH (dZVpwHhe000:`Person`)-[JcVKsSrn001:`ACTED_IN` {role: 'Neo'}]-&gt;(cDWeUJSI002:`Movie`) RETURN cDWeUJSI002`` as we didn't specify aliases)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="workwithrelationships"><a class="anchor" href="#workwithrelationships"></a>7.2.3. Work with relationships</h4>
<div class="paragraph">
<p>Relationships can be worked with like with properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var cypher = Cypher.match(Person.PERSON.DIRECTED)
    .match(Person.PERSON.ACTED_IN)
    .returning(Person.PERSON.DIRECTED, Person.PERSON.ACTED_IN)
    .build().getCypher();</code></pre>
</div>
</div>
<div class="paragraph">
<p>They are quite flexible together with the <code>inverse</code> method. The following example also shows how to include non-static parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var otherPerson = Person.PERSON.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">o</span><span class="delimiter">&quot;</span></span>);
var cypher = Cypher.match(
        Person.PERSON.DIRECTED.inverse()
            .relationshipTo(otherPerson, <span class="string"><span class="delimiter">&quot;</span><span class="content">FOLLOWS</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
    )
    .where(otherPerson.NAME.isEqualTo(Cypher.literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Someone</span><span class="delimiter">&quot;</span></span>)))
    .returning(Person.PERSON)
    .build().getCypher();

Assertions.assertThat(cypher)
    .matches(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH </span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">w+:`Movie`</span><span class="char">\\</span><span class="content">)&lt;-</span><span class="char">\\</span><span class="content">[:`DIRECTED`]-</span><span class="char">\\</span><span class="content">(</span><span class="char">\\</span><span class="content">w+:`Person`</span><span class="char">\\</span><span class="content">)-</span><span class="char">\\</span><span class="content">[:`FOLLOWS`]-&gt;</span><span class="char">\\</span><span class="content">(o:`Person`</span><span class="char">\\</span><span class="content">) WHERE o</span><span class="char">\\</span><span class="content">.name = 'Someone' RETURN </span><span class="char">\\</span><span class="content">w+</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using a non-static fragment</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="thespringdataneo4j6annotationprocessor"><a class="anchor" href="#thespringdataneo4j6annotationprocessor"></a>7.3. The Spring Data Neo4j 6 annotation processor</h3>
<div class="paragraph">
<p>We provide a Java annotation processor for <a href="https://docs.spring.io/spring-data/neo4j/docs/current/reference/html/#reference">Spring Data Neo4j</a> under the following coordinates:</p>
</div>
<div class="listingblock">
<div class="title">Listing 40. Coordinates of the SDN 6 annotation processor</div>
<div class="content">
<pre class="CodeRay highlight"><code>org.neo4j:neo4j-cypher-dsl-codegen-sdn6:2021.3.1-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation processor understands classes annotated with <code>@Node</code> and <code>@RelationshipProperties</code>.
Inside those classes <code>@Relationship</code> and <code>@Property</code> are read.</p>
</div>
<div class="paragraph">
<p>The processor generates a static meta model for each annotated class found in the same package with an underscore (<code>_</code>) added to the name.</p>
</div>
<div class="paragraph">
<p>The processor needs Spring Data Neo4j 6 and the Cypher-DSL in version <code>2021.1.0</code> or later on it&#8217;s classpath.
We recommend using it explicitly on the separate annotation processor classpath (via <code>--processor-path</code> to <code>javac</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Please make sure to use <code>@Relationship</code> when you use the annotation processor. While we do our best to detect possible,
     implicit associations during annotation processing, we can&#8217;t load classes that are being processed that very moment
     to check if the Spring infrastructure would provide a custom converter for them and make them a simple property.
     We won&#8217;t generate fields when in doubt but relationships if we find the corresponding class.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configureyourbuild"><a class="anchor" href="#configureyourbuild"></a>7.3.1. Configure your build</h4>
<div class="sect4">
<h5 id="maven2"><a class="anchor" href="#maven2"></a>Maven</h5>
<div class="paragraph">
<p>As a Maven user, please configure the build as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
        <span class="tag">&lt;plugin&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;annotationProcessorPaths&gt;</span>
                    <span class="tag">&lt;annotationProcessorPath&gt;</span>
                        <span class="tag">&lt;groupId&gt;</span>org.neo4j<span class="tag">&lt;/groupId&gt;</span>
                        <span class="tag">&lt;artifactId&gt;</span>neo4j-cypher-dsl-codegen-sdn6<span class="tag">&lt;/artifactId&gt;</span>
                        <span class="tag">&lt;version&gt;</span>{neo4j-cypher-dsl.version}<span class="tag">&lt;/version&gt;</span>
                    <span class="tag">&lt;/annotationProcessorPath&gt;</span>
                <span class="tag">&lt;/annotationProcessorPaths&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gradle2"><a class="anchor" href="#gradle2"></a>Gradle</h5>
<div class="paragraph">
<p>In a Gradle project, please add the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    annotationProcessor <span class="string"><span class="delimiter">'</span><span class="content">org.neo4j:neo4j-cypher-dsl-codegen-sdn6:2021.3.1-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="asdependencyontheclasspath"><a class="anchor" href="#asdependencyontheclasspath"></a>As dependency on the classpath</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We recommend the annotation processor path for two reasons: The processor needs SDN as dependency. While SDN is already on the classpath,
it might not fit the one we build the annotation processor against exactly.
While the processor is lenient in that regard, your dependency setup might not.
Furthermore: Why should you have the annotation processor as a dependency in your final artifact? This would be unnecessary.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you insist on having the SDN 6 annotation processor on the standard class path, please include with your Spring Data Neo4j 6
application like as follows to avoid dependency conflicts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.neo4j<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>neo4j-cypher-dsl-codegen-sdn6<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>{neo4j-cypher-dsl.version}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;optional&gt;</span>true<span class="tag">&lt;/optional&gt;</span>
    <span class="tag">&lt;exclusions&gt;</span>
        <span class="tag">&lt;exclusion&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.slf4j<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>slf4j-simple<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/exclusion&gt;</span>
        <span class="tag">&lt;exclusion&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.data<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-data-neo4j<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/exclusion&gt;</span>
    <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="usage"><a class="anchor" href="#usage"></a>7.3.2. Usage</h4>
<div class="paragraph">
<p>The processor supports the following arguments:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.cypherdsl.codegen.prefix,</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional prefix for the generated classes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.cypherdsl.codegen.suffix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional suffix for the generated classes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.cypherdsl.codegen.indent_style</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The indent style (Use <code>TAB</code> for tabs, <code>SPACE</code> for spaces)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.cypherdsl.codegen.indent_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of whitespaces for the indent style <code>SPACE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.cypherdsl.codegen.timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional timestamp in ISO_OFFSET_DATE_TIME format for the generated classes. Defaults to the time of generation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.cypherdsl.codegen.add_at_generated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A flag whether <code>@Generated</code> should be added</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.neo4j.cypherdsl.codegen.sdn.custom_converter_classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of custom Spring converter classes (Can be <code>Converter</code>, <code>GenericConverter</code>, <code>ConverterAware</code>,
  pretty much everything you can register with <code>org.springframework.data.neo4j.core.convert.Neo4jConversions</code> ). However,
  these converters must have a default-non-args constructor in the context of the annotation processor.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The generated classes can be used in a variety of places:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util.Collection</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Cypher</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Functions</span>;
<span class="keyword">import</span> <span class="include">org.springframework.data.domain.Sort</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Service</span>;

<span class="annotation">@Service</span>
<span class="directive">final</span> <span class="type">class</span> <span class="class">MovieService</span> {

    <span class="directive">private</span> <span class="directive">final</span> MovieRepository movieRepository;

    MovieService(MovieRepository movieRepository) {
        <span class="local-variable">this</span>.movieRepository = movieRepository;
    }

    <span class="predefined-type">List</span>&lt;Movie&gt; findAll() {

        <span class="keyword">return</span> movieRepository
            .findAll(Sort.by(Movie_.MOVIE.TITLE.getName()).ascending()); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pass the name of the property <code>TITLE</code> to Spring Data&#8217;s sort facility</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Spring Data Neo4j 6.1 has two additional query fragments, that makes working with the Cypher-DSL very efficient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.data.neo4j.repository.Neo4jRepository</span>;
<span class="keyword">import</span> <span class="include">org.springframework.data.neo4j.repository.support.CypherdslConditionExecutor</span>;
<span class="keyword">import</span> <span class="include">org.springframework.data.neo4j.repository.support.CypherdslStatementExecutor</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">PeopleRepository</span> <span class="directive">extends</span> Neo4jRepository&lt;Person, <span class="predefined-type">Long</span>&gt;,
    CypherdslConditionExecutor&lt;Person&gt;, <i class="conum" data-value="1"></i><b>(1)</b>
    CypherdslStatementExecutor&lt;Person&gt; { <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allows to just add conditions to our generated queries</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Provides an alternative to using @Query with strings</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both interfaces are <strong>independent</strong>  of each other, they can be used together like in this example or separately (just picking the one you need).
You can read more about them in the Spring Data Neo4j 6.1 documentation, chapter <a href="https://docs.spring.io/spring-data/neo4j/docs/6.1.0-M5/reference/html/#sdn-mixins">Spring Data Neo4j Extensions</a>.</p>
</div>
<div class="paragraph">
<p>The repository above can be used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.util.Optional</span>;
<span class="keyword">import</span> <span class="include">java.util.function.Function</span>;

<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Conditions</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Cypher</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Expression</span>;
<span class="keyword">import</span> <span class="include">org.neo4j.cypherdsl.core.Functions</span>;
<span class="keyword">import</span> <span class="include">org.springframework.data.neo4j.core.mapping.Constants</span>;
<span class="keyword">import</span> <span class="include">org.springframework.stereotype.Service</span>;

<span class="annotation">@Service</span>
<span class="directive">final</span> <span class="type">class</span> <span class="class">PeopleService</span> {

    <span class="directive">static</span> <span class="directive">final</span> Person_ PERSON = Person_.PERSON.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">private</span> <span class="directive">final</span> PeopleRepository peopleRepository;

    PeopleService(PeopleRepository peopleRepository) {
        <span class="local-variable">this</span>.peopleRepository = peopleRepository;
    }

    <span class="predefined-type">Iterable</span>&lt;Person&gt; findPeopleBornInThe70tiesOr(Optional&lt;<span class="predefined-type">String</span>&gt; optionalName) {

        <span class="keyword">return</span> peopleRepository.findAll(
            PERSON.BORN.gte(Cypher.literalOf(<span class="integer">1970</span>)).and(PERSON.BORN.lt(Cypher.literalOf(<span class="integer">1980</span>))) <i class="conum" data-value="1"></i><b>(1)</b>
                .or(optionalName
                    .map(name -&gt; PERSON.NAME.isEqualTo(Cypher.anonParameter(name))) <i class="conum" data-value="2"></i><b>(2)</b>
                    .orElseGet(Conditions::noCondition)) <i class="conum" data-value="3"></i><b>(3)</b>
        );
    }

    Optional&lt;PersonDetails&gt; findDetails(<span class="predefined-type">String</span> name) {

        var d = Movie_.MOVIE.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>);
        var a = Movie_.MOVIE.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
        var m = Movie_.MOVIE.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">movies</span><span class="delimiter">&quot;</span></span>);
        var r = Cypher.anyNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">relatedPerson</span><span class="delimiter">&quot;</span></span>);
        var statement = Cypher.match(Person_.PERSON.withProperties(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, Cypher.anonParameter(name)))
            .optionalMatch(d.DIRECTORS)
            .optionalMatch(a.ACTORS)
            .optionalMatch(Person_.PERSON.relationshipTo(m).relationshipFrom(r, ActedIn_.<span class="error">$</span>TYPE))
            .returningDistinct(
                Person_.PERSON.getRequiredSymbolicName(),
                Functions.collectDistinct(d).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">directed</span><span class="delimiter">&quot;</span></span>),
                Functions.collectDistinct(a).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">actedIn</span><span class="delimiter">&quot;</span></span>),
                Functions.collectDistinct(r).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">related</span><span class="delimiter">&quot;</span></span>)).build();

        <span class="keyword">return</span> peopleRepository.findOne(statement, PersonDetails.class); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using literals</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using an optional parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or when it&#8217;s not filled, an empty condition</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Project a person onto <code>PersonDetails</code>, using a complex query.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is another complex example. The <code>MovieRepository</code> is also a <code>CypherdslStatementExecutor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Collection</span>&lt;Movie&gt; findAllRelatedTo(Person person) {

    var p = Person_.PERSON.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>);
    var a = Movie_.MOVIE.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
    var d = Movie_.MOVIE.named(<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>);
    var m = Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">m</span><span class="delimiter">&quot;</span></span>);

    var statement = Cypher.match(p)
        .where(p.NAME.isEqualTo(Cypher.anonParameter(person.getName()))) <i class="conum" data-value="1"></i><b>(1)</b>
        .with(p)
        .optionalMatch(<span class="keyword">new</span> ActedIn_(p, a))
        .optionalMatch(<span class="keyword">new</span> Directed_(p, d))
        .with(Functions.collect(a).add(Functions.collect(d))
            .as(<span class="string"><span class="delimiter">&quot;</span><span class="content">movies</span><span class="delimiter">&quot;</span></span>))
        .unwind(<span class="string"><span class="delimiter">&quot;</span><span class="content">movies</span><span class="delimiter">&quot;</span></span>).as(m)
        .returningDistinct(m)
        .orderBy(Movie_.MOVIE.named(m).TITLE).ascending()
        .build();

    <span class="keyword">return</span> <span class="local-variable">this</span>.movieRepository.findAll(statement);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here we use an anonymous parameter to store the <code>name</code> value</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The full example is in <code>neo4j-cypher-dsl-examples/neo4j-cypher-dsl-examples-sdn6</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a>8. Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="query-dsl-support"><a class="anchor" href="#query-dsl-support"></a>Query-DSL support</h3>
<div class="paragraph">
<p>The Neo4j Cypher-DSL has some support for <a href="http://www.querydsl.com">Query-DSL</a>. It can</p>
</div>
<div class="ulist">
<ul>
<li>
<p>turn instances of <code>com.querydsl.core.types.Predicate</code> into <code>org.neo4j.cypherdsl.core.Condition</code>,</p>
</li>
<li>
<p>turn instances of <code>com.querydsl.core.types.Expression</code> into <code>org.neo4j.cypherdsl.core.Expression</code>,</p>
</li>
<li>
<p>create <code>org.neo4j.cypherdsl.core.Node</code> instances from <code>com.querydsl.core.types.Path</code> and also</p>
</li>
<li>
<p>create <code>org.neo4j.cypherdsl.core.SymbolicName</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With this, many static meta models based on Query-DSL can be used to create Queries and match on nodes.
Most operations supported by Query-DSL are translated into Cypher that is understood by Neo4j 4.0+, so that most predicates
should work - at least from a syntactic point of view - out of the box.</p>
</div>
<div class="paragraph">
<p>Expressions are most useful to address properties in return statements and the like.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s one example on how to use it:</p>
</div>
<div id="appendix.query-dsl-support.query-dsl-simple" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QPerson n = <span class="keyword">new</span> QPerson(<span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">Statement</span> statement = Cypher.match(Cypher.adapt(n).asNode()) <i class="conum" data-value="2"></i><b>(2)</b>
    .where(Cypher.adapt(n.firstName.eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">P</span><span class="delimiter">&quot;</span></span>).and(n.age.gt(<span class="integer">25</span>))).asCondition()) <i class="conum" data-value="3"></i><b>(3)</b>
    .returning(Cypher.adapt(n).asName()) <i class="conum" data-value="4"></i><b>(4)</b>
    .build();

assertThat(statement.getParameters()).isEmpty();
assertThat(statement.getCypher())
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:`Person`) WHERE n.firstName = 'P' AND n.age &gt; 25 RETURN n</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This makes use of a "Q"-class generated by Query-DSL APT (using the general processor).
<code>alias</code> and class based paths works, too.
Please make sure to name the instance accordingly when you use it as node (see next step)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adapt the "Q"-class into a node. Please note it must be named accordingly, otherwise you query
won&#8217;t return the expected results</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create some Query-DSL predicate based on the properties and adapt it as condition</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Return some Query-DSL properties and adapt it as expression</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Statement</code> offers a way to render all constants as parameters, so that they don&#8217;t bust the query cache:</p>
</div>
<div id="appendix.query-dsl-support.query-dsl-simple-avoid-constants" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QPerson n = <span class="keyword">new</span> QPerson(<span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Statement</span> statement = Cypher.match(Cypher.adapt(n).asNode())
    .where(Cypher.adapt(n.firstName.eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">P</span><span class="delimiter">&quot;</span></span>).and(n.age.gt(<span class="integer">25</span>))).asCondition())
    .returning(Cypher.adapt(n).asName())
    .build();

statement.setRenderConstantsAsParameters(<span class="predefined-constant">true</span>); <i class="conum" data-value="1"></i><b>(1)</b>
assertThat(statement.getParameters()).containsEntry(<span class="string"><span class="delimiter">&quot;</span><span class="content">pcdsl01</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">P</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>
assertThat(statement.getParameters()).containsEntry(<span class="string"><span class="delimiter">&quot;</span><span class="content">pcdsl02</span><span class="delimiter">&quot;</span></span>, <span class="integer">25</span>);
assertThat(statement.getCypher())
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:`Person`) WHERE n.firstName = $pcdsl01 AND n.age &gt; $pcdsl02 RETURN n</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set this to true before accessing parameters of the statement or rendering the statement</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the statements parameters for generated parameter names</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Compare the statement to the first listening. Constants are gone now</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Neo4j Cypher-DSL will collect all parameters defined via Query-DSL for you:</p>
</div>
<div id="appendix.query-dsl-support.query-dsl-parameters" class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">QPerson n = <span class="keyword">new</span> QPerson(<span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Statement</span> statement = Cypher.match(Cypher.adapt(n).asNode())
    .where(Cypher.adapt(n.firstName.eq(<span class="keyword">new</span> Param&lt;&gt;(<span class="predefined-type">String</span>.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
            .and(n.age.gt(<span class="keyword">new</span> Param&lt;&gt;(<span class="predefined-type">Integer</span>.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>))) <i class="conum" data-value="1"></i><b>(1)</b>
        ).asCondition()
    )
    .returning(Cypher.adapt(n).asName())
    .build();

assertThat(statement.getParameterNames()).hasSize(<span class="integer">2</span>); <i class="conum" data-value="2"></i><b>(2)</b>
assertThat(statement.getCypher())
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (n:`Person`) WHERE n.firstName = $name AND n.age &gt; $age RETURN n</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Basically the same predicate as above, but with parameters, which will be turned into correct placeholders</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the parameter names via the <code>Statement</code> object</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="requireddependencies"><a class="anchor" href="#requireddependencies"></a>Required dependencies</h4>
<div class="paragraph">
<p>The Query-DSL support in the Neo4j Cypher-DSL is optional, and the Query-DSL dependency is only in the <code>provided</code> scope.
To make use of <code>Cypher.adapt()</code>, you must add the following dependency in addition to the Cypher-DSL:</p>
</div>
<div class="sect4">
<h5 id="maven3"><a class="anchor" href="#maven3"></a>Maven</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.querydsl<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>querydsl-core<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>4.4.0<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>provided<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gradle3"><a class="anchor" href="#gradle3"></a>Gradle</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.querydsl:query-dsl-core:4.4.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you want to use an annotation processor, you have to add additional dependencies and depending on your Java environment.
We use the following in our tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>com.querydsl<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>querydsl-apt<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>4.4.0<span class="tag">&lt;/version&gt;</span>
        <span class="tag">&lt;classifier&gt;</span>general<span class="tag">&lt;/classifier&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>javax.annotation<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>javax.annotation-api<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.3.2<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="buildingtheneo4jcypher-dsl"><a class="anchor" href="#buildingtheneo4jcypher-dsl"></a>Building the Neo4j Cypher-DSL</h3>
<div class="sect3">
<h4 id="requirements"><a class="anchor" href="#requirements"></a>Requirements</h4>
<div class="paragraph">
<p>For the full project, including examples and native tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GraalVM based on JDK 11: <a href="https://www.graalvm.org/downloads/" class="bare">https://www.graalvm.org/downloads/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the project, including examples but skipping native tests</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK 11+ (Can be <a href="https://openjdk.java.net">OpenJDK</a> or <a href="https://www.oracle.com/technetwork/java/index.html">Oracle JDK</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Maven 3.6.3 is our build tool of choice. We provide the Maven wrapper, see <code>mvnw</code> respectively <code>mvnw.cmd</code> in the project root; the wrapper downloads the appropriate Maven version automatically.</p>
</div>
<div class="paragraph">
<p>The build requires a local copy of the project:</p>
</div>
<div id="clone-cypher-dsl" class="listingblock">
<div class="title">Listing 41. Clone the Neo4j Cypher-DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ git clone git@github.com:neo4j-contrib/cypher-dsl.git</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="fullbuildincludingexamplesandnativetests"><a class="anchor" href="#fullbuildincludingexamplesandnativetests"></a>Full build (including examples and native tests)</h4>
<div class="paragraph">
<p>Before you proceed, verify your locally installed JDK version.
The output should be similar:</p>
</div>
<div id="verify-jdk" class="listingblock">
<div class="title">Listing 42. Verify your JDK</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ java -version
openjdk version &quot;11.0.10&quot; 2021-01-19
OpenJDK Runtime Environment GraalVM CE 21.0.0 (build 11.0.10+8-jvmci-21.0-b06)
OpenJDK 64-Bit Server VM GraalVM CE 21.0.0 (build 11.0.10+8-jvmci-21.0-b06, mixed mode, sharing)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check whether GraalVM <code>native-image</code> is present with:</p>
</div>
<div id="verify-native-image" class="listingblock">
<div class="title">Listing 43. Check for the present of <code>native-image</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ gu list
ComponentId              Version             Component name                Stability           Origin
--------------------------------------------------------------------------------------------------------
js                       21.0.0              Graal.js                      -
graalvm                  21.0.0              GraalVM Core                  -
native-image             21.0.0              Native Image                  Early adopter       github.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see <code>native-image</code> in the list. If not, install it via <code>gu install native-image</code>.</p>
</div>
<div class="paragraph">
<p>After that, use <code>./mvnw</code> on a Unix-like operating system to build the Cypher-DSL:</p>
</div>
<div id="build-default-bash" class="listingblock">
<div class="title">Listing 44. Build with default settings on Linux / macOS</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ ./mvnw clean verify</code></pre>
</div>
</div>
<div class="paragraph">
<p>On a Windows machine, use</p>
</div>
<div id="build-default-windows" class="listingblock">
<div class="title">Listing 45. Build with default settings on Windows</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ mvnw.cmd clean verify</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="skippingnativetests"><a class="anchor" href="#skippingnativetests"></a>Skipping native tests</h4>
<div class="paragraph">
<p>On a plain JDK 11 or higher, run the following to skip the native tests:</p>
</div>
<div id="build-skip-native-bash" class="listingblock">
<div class="title">Listing 46. Skipping native tests</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ ./mvnw clean verify -pl \!org.neo4j:neo4j-cypher-dsl-native-tests</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="buildonlythecoremodule"><a class="anchor" href="#buildonlythecoremodule"></a>Build only the core module</h4>
<div class="paragraph">
<p>The core module can be build on plain JDK 11 with:</p>
</div>
<div id="build-only-core-bash" class="listingblock">
<div class="title">Listing 47. Skipping native tests</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ ./mvnw clean verify -pl org.neo4j:neo4j-cypher-dsl</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2 group">
<h3 id="arch-rules"><a class="anchor" href="#arch-rules"></a>Architecture</h3>
<div class="paragraph">
<p>The Neo4j-Cypher-DSL consists of one main module: <code>org.neo4j.cypherdsl.core</code>.
The coordinates of that module <code>org.neo4j:neo4j-cypher-dsl</code>, the JDK module name is <code>org.neo4j.cypherdsl.core</code>.
The rendering feature is part of the core module.</p>
</div>
<div class="paragraph">
<p>All other modules depend on the core. As the core reflects the Cypher language, it is not meant to be extendable.
Therefore, there is little to know API to do so with the AST visitor being the exception.</p>
</div>
<div class="paragraph">
<p>We document our rules structure with <a href="https://jqassistant.org">jQAssistant</a>,
a Neo4j based tool for software analysis. jQAssistant is integrated in our build.</p>
</div>
<div class="paragraph">
<p>To run the analysis standalone, you have to compile and build the project first. As you can skip both examples and
native tests, JDK 8 is sufficient todo so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">java --version <i class="conum" data-value="1"></i><b>(1)</b>
./mvnw clean verify \
  -pl \!org.neo4j:neo4j-cypher-dsl-examples,\!org.neo4j:neo4j-cypher-dsl-native-tests <i class="conum" data-value="2"></i><b>(2)</b>
./mvnw jqassistant:server <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Must be at least Java 8</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Build and verify all modules except the examples and the native tests, which includes all scannes</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Start a local Neo4j server, reachable at <a href="http://localhost:7474/browser/" class="bare">http://localhost:7474/browser/</a>. The instance contains a dedicated jQAssistant
dashboard as well: <a href="http://localhost:7474/jqassistant/dashboard/" class="bare">http://localhost:7474/jqassistant/dashboard/</a></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to change the default Neo4j HTTP- and Bolt-ports, start the server like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./mvnw jqassistant:server -Djqassistant.embedded.httpPort=4711 -Djqassistant.embedded.boltPort=9999</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="codingrules"><a class="anchor" href="#codingrules"></a>Coding rules</h4>
<div class="sect4 group">
<h5 id="arch-rules.naming"><a class="anchor" href="#arch-rules.naming"></a>Consistent naming</h5>
<div class="paragraph">
<p>The following naming conventions are used throughout the project:</p>
</div>
<div id="arch-rules.naming:TypeNameMustBeginWithGroupId" class="listingblock constraint">
<div class="title">Listing 48. All Java types must be located in packages that start with <code>org.neo4j.cypherdsl</code>.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH
  (project:Maven:Project)-[:CREATES]-&gt;(:Artifact)-[:CONTAINS]-&gt;(type:Type)
WHERE NOT type.fqn starts with 'org.neo4j.cypherdsl'
  AND type.fqn &lt;&gt; 'module-info'
RETURN
  project as Project, collect(type) as TypeWithWrongName</code></pre>
</div>
</div>
</div>
<div class="sect4 group">
<h5 id="arch-rules.api"><a class="anchor" href="#arch-rules.api"></a>API</h5>
<div class="sect5">
<h6 id="generalconsiderations"><a class="anchor" href="#generalconsiderations"></a>General considerations</h6>
<div class="paragraph">
<p>We use <a href="https://github.com/apiguardian-team/apiguardian">@API Guardian</a> to keep track of what we expose as public or internal API.
To keep things both clear and concise, we restrict the usage of those annotations to interfaces, classes (only public methods and constructors:
and annotations.</p>
</div>
<div id="arch-rules.api:api-guardian-usage" class="listingblock constraint">
<div class="title">Listing 49. @API Guardian annotations must not be used on fields</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (c:Java)-[:ANNOTATED_BY]-&gt;(a)-[:OF_TYPE]-&gt;(t:Type {fqn: 'org.apiguardian.api.API'}),
      (p)-[:DECLARES]-&gt;(c)
WHERE c:Member AND NOT (c:Constructor OR c:Method)
RETURN p.fqn, c.name</code></pre>
</div>
</div>
<div class="paragraph">
<p>Public interfaces, classes or annotations are either part of internal or public API and therefore must have a status:</p>
</div>
<div id="arch-rules.api:api-guardian-api-concept" class="listingblock concept">
<div class="title">Listing 50. Define which Java artifacts are part of internal or public API</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (c:Java)-[:ANNOTATED_BY]-&gt;(a)-[:OF_TYPE]-&gt;(t:Type {fqn: 'org.apiguardian.api.API'}),
      (a)-[:HAS]-&gt;({name: 'status'})-[:IS]-&gt;(s)
WHERE ANY (label IN labels(c) WHERE label in ['Interface', 'Class', 'Annotation'])
WITH  c, trim(split(s.signature, ' ')[1]) AS status
WITH  c, status,
      CASE status
        WHEN 'INTERNAL' THEN 'Internal'
        ELSE 'Public'
      END AS type
MERGE (a:Api {type: type, status: status})
MERGE (c)-[:IS_PART_OF]-&gt;(a)
RETURN c,a</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="internalapi"><a class="anchor" href="#internalapi"></a>Internal API</h6>
<div class="paragraph">
<p>While we are pretty clear about the intended use of our classes (being experimental, public API or strictly internal),
we want to make sure that no-one can coincidentally inherit from internal classes that we couldn&#8217;t restrict to default
package visibility:</p>
</div>
<div id="arch-rules.api:internal" class="listingblock constraint">
<div class="title">Listing 51. Non abstract, public classes that are only part of internal API must be final</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (c:Class)-[:IS_PART_OF]-&gt;(:Api {type: 'Internal'})
WHERE c.visibility = 'public'
  AND coalesce(c.abstract, false) = false
  AND NOT exists(c.final)
RETURN c.name</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="structure"><a class="anchor" href="#structure"></a>Structure</h4>
<div class="sect4 group">
<h5 id="arch-rules.structure"><a class="anchor" href="#arch-rules.structure"></a>Neo4j-Cypher-DSL Core</h5>
<div class="paragraph">
<p>The core of the Cypher-DSL is consist of a set of classes that loosely reassemble the <a href="https://www.opencypher.org">openCypher spec</a>,
especially in the <a href="https://s3.amazonaws.com/artifacts.opencypher.org/M15/railroad/Cypher.html">railroad diagrams</a>.</p>
</div>
<div class="paragraph">
<p>The main package of the core module is <code>org.neo4j.cypherdsl.core</code> which also reflects in the JDK module name: <code>org.neo4j.cypherdsl.core</code>.
Part of the Cypher-DSL core is also the <code>renderer</code> package as the main goal of the core is to render Cypher.
The <code>renderer</code> package is a sub-package of <code>core</code> as it is an essential part of it and in addition, the above mentioned
JDK module name should reflect exactly one package.</p>
</div>
<div class="paragraph">
<p>So while all other subpackages in <code>core</code> can be used freely from the <code>core</code> classes themselves, we don&#8217;t want to access the
<code>renderer</code> package apart from one exception: The <code>AbstractStatement</code> class can be used to invoke the rendering process without
explicitly specifying a renderer:</p>
</div>
<div id="arch-rules.structure:core-must-not-depend-on-renderer" class="listingblock constraint">
<div class="title">Listing 52. The Cypher-DSL core package must not depend on the rendering infrastructure</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (a:Main:Artifact)
MATCH (a)-[:CONTAINS]-&gt;(p1:Package)
WHERE p1.fqn in ['org.neo4j.cypherdsl.core']
WITH p1, a
MATCH (p1)-[:CONTAINS]-&gt;(t:Type)
MATCH (t)-[:DEPENDS_ON]-&gt;(t2:Type)&lt;-[:CONTAINS]-(p2:Package)&lt;-[:CONTAINS]-(a)
WHERE p2.fqn = 'org.neo4j.cypherdsl.core.renderer'
  AND t.fqn &lt;&gt; 'org.neo4j.cypherdsl.core.AbstractStatement'
RETURN t, t2</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>renderer</code> package is not only free to use the whole <code>core</code>, it must do so to fulfill its purpose.
The <code>ast</code> and <code>utils</code> packages however should not have dependencies outside their own:</p>
</div>
<div id="arch-rules.structure:supporting-packages-are-dependency-free" class="listingblock constraint">
<div class="title">Listing 53. Supporting packages must not depend on anything from the outside</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (a:Main:Artifact)
MATCH (a)-[:CONTAINS]-&gt;(p1:Package)-[:DEPENDS_ON]-&gt;(p2:Package)&lt;-[:CONTAINS]-(a)
WHERE p1.fqn IN ['org.neo4j.cypherdsl.core.ast', 'org.neo4j.cypherdsl.core.utils']
RETURN p1,p2;</code></pre>
</div>
</div>
<div class="paragraph">
<p>There should not be any internal, public API inside the core package.
Everything that needs to be public for reasons (like being used in the renderer), must go into the <code>internal</code> package.
This package won&#8217;t be exported via <code>module-info.java</code>.</p>
</div>
<div id="arch-rules.structure:public-internal-api-is-in-internal-package" class="listingblock constraint">
<div class="title">Listing 54. Public internal API goes into a dedicated package</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MATCH (c:Class)-[:IS_PART_OF]-&gt;(:Api {type: 'Internal'})
MATCH (p:Package) - [:CONTAINS] -&gt; (c)
WHERE c.visibility = 'public'
AND coalesce(c.abstract, false) = false
AND p.fqn = 'org.neo4j.cypherdsl.core'
RETURN c, p</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changelog"><a class="anchor" href="#changelog"></a>Change log</h3>
<div class="sect3">
<h4 id="2021.3"><a class="anchor" href="#2021.3"></a>2021.3</h4>
<div class="sect4">
<h5 id="2021.3.0"><a class="anchor" href="#2021.3.0"></a>2021.3.0</h5>
<div class="sect5">
<h6 id="newmodulethecypher-dsl-parser"><a class="anchor" href="#newmodulethecypher-dsl-parser"></a> New module: The Cypher-DSL-Parser</h6>
<div class="paragraph">
<p>2021.3 builds straight upon <a href="#2021.2.3">2021.2.3</a>, with few additions to the existing API, that didn&#8217;t quite fit with a patch release,
but belong conceptually into this release, which brings a completely new module: The <code>neo4j-cypher-dsl-parser</code>.</p>
</div>
<div class="paragraph">
<p>What&#8217;s behind that name? A Cypher-Parser build on the official Neo4j 4.3 parser frontend and creating a Cypher-DSL-AST or
single expressions usable in the context of the Cypher-DSL.</p>
</div>
<div class="paragraph">
<p>The module lives under the following coordinates <code>org.neo4j:neo4j-cypher-dsl-parser</code> and requires JDK 11+ (the same version like Neo4j does).
We created a couple of <a href="#cypher-parser-examples">examples</a>, but we are sure you will have tons of more ideas and therefore
a looking for your feedback.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a sneak preview. It shows you can add a user supplied Cypher fragment to something you are building using the DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var userProvidedCypher
    = <span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (this)-[:LINK]-(o:Other) RETURN o as result</span><span class="delimiter">&quot;</span></span>;
var userStatement = CypherParser.parse(userProvidedCypher);

var node = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Node</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">node</span><span class="delimiter">&quot;</span></span>);
var result = Cypher.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>);
var cypher = Cypher
    .match(node)
    .call(
        userStatement,
        node.as(<span class="string"><span class="delimiter">&quot;</span><span class="content">this</span><span class="delimiter">&quot;</span></span>)
    )
    .returning(result.project(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>))
    .build()
    .getCypher();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For this release a big thank you goes out to the Cypher-operations team at Neo4j, listening to our requests and ideas!</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="2021.2"><a class="anchor" href="#2021.2"></a>2021.2</h4>
<div class="sect4">
<h5 id="2021.2.3"><a class="anchor" href="#2021.2.3"></a>2021.2.3</h5>
<div class="paragraph">
<p>2021.2.3 is a rather big release as it contains many small improvements and API functionality required by our next major
release. Those are brought in now so that they can be benefial to others without bumping a major version.</p>
</div>
<div class="sect5">
<h6 id="features"><a class="anchor" href="#features"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-195 - Add collection parameter support for <code>ExposesReturning</code>.</p>
</li>
<li>
<p>Introduce a <code>ExposesPatternLengthAccessors</code> for uniform access to relationships and chains thereof. [improvement]</p>
</li>
<li>
<p>Allow creating instances of <code>FunctionInvocation</code> directly. [improvement]</p>
</li>
<li>
<p>Provide factory methods of <code>MapProjection</code> and <code>KeyValueMapEntry</code> as public API.</p>
</li>
<li>
<p>Provide <code>set</code> and <code>remove</code> labels operation as public API.</p>
</li>
<li>
<p>Provide <code>set</code> and <code>mutate</code> of expressions as public API.</p>
</li>
<li>
<p>Provide factory methods of <code>Hints</code> as public API.</p>
</li>
<li>
<p>GH-200 - Provide an API to define named paths based on a <code>Node</code> pattern.</p>
</li>
<li>
<p>Provide an option to escape names only when necessary. [improvement]</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="documentation"><a class="anchor" href="#documentation"></a> Documentation</h6>
<div class="ulist">
<ul>
<li>
<p>Add documentation for escaping names.</p>
</li>
<li>
<p>GH-198 - Fix spelling errors in JavaDoc and documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes"><a class="anchor" href="#bugfixes"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>Make <code>Case</code> an interface and let it extend <code>Expression</code>. [bug]</p>
</li>
<li>
<p>GH-197 - Fix eagerly resolved symbolic names in negated pattern conditions.</p>
</li>
<li>
<p>GH-197 - Clear name cache after leaving a statement.</p>
</li>
<li>
<p>GH-199 - Bring back <code>with(Named vars)</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping"><a class="anchor" href="#housekeeping"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>Don&#8217;t use fixed driver versions in doc.</p>
</li>
<li>
<p>Pass builder as constructor argument.</p>
</li>
<li>
<p>Improve <code>Return</code> and <code>With</code> internals.</p>
</li>
<li>
<p>Update Driver, SDN integration and Spring Boot example dependencies.</p>
</li>
<li>
<p>GH-202 - Make API Guardian an optional / provided dependency.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thanks to <a href="https://github.com/meistermeier">@meistermeier</a> and <a href="https://github.com/aldrinm">@aldrinm</a> for their contributions.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2021.2.2"><a class="anchor" href="#2021.2.2"></a>2021.2.2</h5>
<div class="sect5">
<h6 id="features2"><a class="anchor" href="#features2"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>Allow all expresions to be used as conditions. [improvement]</p>
</li>
<li>
<p>Add support for unary minus and plus operations. [new-feature]</p>
</li>
<li>
<p>Add support for generatic dynamic distinct aggregating function calls. [new-feature]</p>
</li>
<li>
<p>GH-190 - Introduce a union type for named things and aliased expressions.</p>
</li>
<li>
<p>Provide means to pass additional types to the relationship base class. [new-feature]</p>
</li>
<li>
<p>GH-193 - Allow MATCH after YIELD.</p>
</li>
<li>
<p>GH-189 - Provide an alternate api for methods consuming collections via vargs.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="documentation2"><a class="anchor" href="#documentation2"></a> Documentation</h6>
<div class="ulist">
<ul>
<li>
<p>Improve inheritance example. [static-model, codegen]</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes2"><a class="anchor" href="#bugfixes2"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>Fix parameter collector when running as GraalVM native image</p>
</li>
<li>
<p>GH-192 - Don&#8217;t introduce new symbolic names in conditional pattern expressions.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping2"><a class="anchor" href="#housekeeping2"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>GH-178 - Upgrade SDN 6 examples to Spring Boot 2.5 final.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thanks to <a href="https://github.com/meistermeier">@meistermeier</a> for the contribution of the API improvements in regard to collections.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2021.2.1"><a class="anchor" href="#2021.2.1"></a>2021.2.1</h5>
<div class="sect5">
<h6 id="features3"><a class="anchor" href="#features3"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>Distinguish between statements and result statements: The Cypher-DSL knows whether a statement would actually return
data or not</p>
</li>
<li>
<p>Provide optional integration with the Neo4j-Java-Driver to execute statements.</p>
</li>
<li>
<p>Allow to register Spring converters with the annotation processor. [codegen]</p>
</li>
<li>
<p>GH-182 - Add support for scalar converter functions.</p>
</li>
<li>
<p>GH-183 - Add trim function.</p>
</li>
<li>
<p>GH-184 - Add split function.</p>
</li>
<li>
<p>GH-180 - Add support for LOAD CSV and friends.</p>
</li>
<li>
<p>GH-187 - Add <code>returningRaw</code> for returning arbitrary (aliased) Cypher fragments (bot as part of a statement or as a
general <code>RETURN xxx</code> clause without preceding query)</p>
</li>
<li>
<p>Resolve named parameters in raw literals: You can mix now the expression placeholder <code>$E</code> and named parameters in raw
Cypher literals giving you much more flexibility in regards what to pass to the raw litera.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes3"><a class="anchor" href="#bugfixes3"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>GH-177 - Create a valid loadable and instantiable name when working on nested, inner classes. [codegen]</p>
</li>
<li>
<p>GH-186 - Pretty print subqueries and fix double rendering of Labels after subquery.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping3"><a class="anchor" href="#housekeeping3"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>Remove unnecessary subpackage 'valid'. [codegen] (test code only)</p>
</li>
<li>
<p>Upgrade to GraalVM 21.1.0.</p>
</li>
<li>
<p>Update Spring dependencies for codegen.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thanks to <a href="https://github.com/Andy2003">@Andy2003</a> for contributing to this release.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2021.2.0"><a class="anchor" href="#2021.2.0"></a>2021.2.0</h5>
<div class="paragraph">
<p>2021.2 doesn&#8217;t bring any new features apart from being now a Java library supporting the Java module system not only with
automatic module names but also with a correct <code>module-info.java</code> when running on JDK 11+ on the module path.</p>
</div>
<div class="paragraph">
<p>The Cypher-DSL uses the technique of <a href="https://openjdk.java.net/jeps/238">JEP 238: Multi-Release JAR Files</a> to provide a
<code>module-info.java</code> for projects being on JDK 11+.</p>
</div>
<div class="paragraph">
<p>The MR-Jar allows us to compile for JDK 8 but also support JDK 11 (we choose 11 as it is the current LTS release as time of writing).</p>
</div>
<div class="paragraph">
<p>To use the Cypher-DSL in a modular application you would need to require the following modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">module org.neo4j.cypherdsl.examples.core {

        requires org.neo4j.cypherdsl.core;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This release comes with a small catch: We do support using some <a href="https://github.com/querydsl/querydsl">QueryDSL</a> constructs.
Query-DSL will have correct automatic module names in their 5.x release and we asked them to backport those to the
4.x line on which the Cypher-DSL <strong>optionally</strong> depends (See <a href="https://github.com/querydsl/querydsl/pull/2805">2805</a>).</p>
</div>
<div class="paragraph">
<p>Until then we statically require (that is "optional" in module speak) Query-DSL via the artifact name.
This can cause errors when the artifact (<code>querydsl-core.jar</code>)  is renamed via the build process or similar.
We are gonna improve that as soon as we can depend on fixed automatic module names.</p>
</div>
<div class="paragraph">
<p>Apart from this big change there is no change in any public API.
This release should be a drop-in replacement for the prior release.</p>
</div>
<div class="paragraph">
<p>A big thank you to <a href="https://github.com/sormuras">@sormuras</a> for his invaluable lessons about the Java module system.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="2021.1"><a class="anchor" href="#2021.1"></a>2021.1</h4>
<div class="sect4">
<h5 id="2021.1.2"><a class="anchor" href="#2021.1.2"></a>2021.1.2</h5>
<div class="paragraph">
<p>This release comes with two notable things: It uses a couple of annotations on the API to guide developers using it correctly.
IDEs like IDEA will now issue warnings if you don&#8217;t use a returned builder, or a new instance of an object while wrongly assuming
you mutated state.</p>
</div>
<div class="paragraph">
<p>In the light of that we discovered that the <code>RelationshipChain</code> pattern was mutable and returning a mutated instance while
it should have returned a fresh one.</p>
</div>
<div class="paragraph">
<p><em>Warning</em> This might be a breaking change for users having code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>var pattern = Cypher.node("Start").named("s")
  .relationshipTo(Cypher.anyNode())
  .relationshipTo(Cypher.node("End").named("e"));
pattern.named("x");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Prior to 2021.1.2 this would give the pattern the name <code>x</code> and modify it in place.
From 2021.1.2 onwards you <strong>must</strong> use the returned value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>pattern = pattern.named("x");</code></pre>
</div>
</div>
<div class="paragraph">
<p>We think that this change is crucial and necessary as all other patterns are immutable as intended and in sum, they build
up truly immutable statements. One pattern that is mutable like the above invalides the whole guarantee about the statement.</p>
</div>
<div class="sect5">
<h6 id="features4"><a class="anchor" href="#features4"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>Add <code>named(SymbolicName s)</code> to RelationshipChain.</p>
</li>
<li>
<p>Generate $TYPE field containing the relationship type. [SDN 6 Annotation Processor]</p>
</li>
<li>
<p>Introduce some optional annotations for guidance along the api.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="documentation3"><a class="anchor" href="#documentation3"></a> Documentation</h6>
<div class="ulist">
<ul>
<li>
<p>GH-173 - Improve documentation. [A collection of small improvements]</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes4"><a class="anchor" href="#bugfixes4"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>GH-174 - Extract types via the visitor API and avoid casting element types. [SDN 6 Annotation Processor]</p>
</li>
<li>
<p>Ensure immutability of <code>RelationshipChain</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping4"><a class="anchor" href="#housekeeping4"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>Remove unnecessary close (will be taken care of via <code>@Container</code>). [Only test related]</p>
</li>
<li>
<p>Run tests on JDK 16</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2021.1.1"><a class="anchor" href="#2021.1.1"></a>2021.1.1</h5>
<div class="paragraph">
<p>This is a drop-in replacement for <a href="#v2021.1.0">2021.1.0</a>. Introducing the interface for <code>Property</code> broke the <code>mutate</code> operation,
for which no test was in place. This and the bug has been fixed.</p>
</div>
<div class="sect5">
<h6 id="bugfixes5"><a class="anchor" href="#bugfixes5"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>GH-168 - Fix mutating containers by properties.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="v2021.1.0"><a class="anchor" href="#v2021.1.0"></a>2021.1.0</h5>
<div class="paragraph">
<p>2021.1.0 comes with a ton of new features and a handful of breaking changes.
Fear not, the breaking changes are resolvable by recompiling your application.
We turned <code>Node</code>, <code>Relationship</code> and <code>Property</code> into interfaces and provide now <code>NodeBase</code> and <code>RelationshipBase</code> so that you can
use them to build a static meta-model of your application. A <code>PropertyBase</code> might follow.</p>
</div>
<div class="paragraph">
<p>Find out everything about the new possibility to define a static meta model in <a href="#static-meta-model">the manual</a>.
The manual also includes a major part about the two new modules we offer:
<code>org.neo4j:neo4j-cypher-dsl-codegen-core</code> and <code>org.neo4j:neo4j-cypher-dsl-codegen-sdn6</code>.
<code>neo4j-cypher-dsl-codegen-core</code> provides the infrastructure necessary to build code generators for creating a domain model
following our recommendation and <code>neo4j-cypher-dsl-codegen-sdn6</code> is a first implementation of that:
A Java annotation processor that can be added to any Spring Data Neo4j 6 project in version 6.0.6 or higher.
It will find your annotated domain classes and turn them into a model you can use to build queries.</p>
</div>
<div class="paragraph">
<p>Last but not least: We added support for some expressions of the more generic <a href="http://www.querydsl.com">QueryDSL</a>.
This will require <code>com.querydsl:querydsl-core</code> on the class path but only if you decide to call <code>Cypher#adapt(foreignExpression)</code>.
This is a feature that is driven by Spring Data Neo4j 6.1 in which we build upon this to provide a <code>QuerydslPredicateExecutor</code>.
Find more in <a href="#query-dsl-support">this section of the manual</a>.</p>
</div>
<div class="sect5">
<h6 id="features5"><a class="anchor" href="#features5"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-154 - Make Node and Relationship extendable.</p>
</li>
<li>
<p>GH-155 - Provide infrastructure for generating a static meta model.</p>
</li>
<li>
<p>GH-156 - Create an annotation processor for Spring Data Neo4j 6.</p>
</li>
<li>
<p>GH-167 - Add support for some Query-DSL expressions.</p>
</li>
<li>
<p>Introduce a statement context for allowing anonymous parameters
(use <code>Cypher#anonParameter()</code> to define a parameter with a value but without a name. The name will be accessible on the statement
after rendering).</p>
</li>
<li>
<p>Make rendering of constants as parameters configurable.</p>
</li>
<li>
<p>Allow specification of the direction while creating a sort item.</p>
</li>
<li>
<p>Introduce an interface for Property.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="documentation4"><a class="anchor" href="#documentation4"></a> Documentation</h6>
<div class="ulist">
<ul>
<li>
<p>GH-152 - Document usage of PatterElement in tests.</p>
</li>
<li>
<p>GH-164 - Improve public extendable API and add documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes6"><a class="anchor" href="#bugfixes6"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>Fix SymbolicName#toString.</p>
</li>
<li>
<p>Clear visited name cache after single queries.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping5"><a class="anchor" href="#housekeeping5"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>GH-165 - Simplify poms.</p>
</li>
<li>
<p>GH-166 - Improve Cypher.literalOf.</p>
</li>
<li>
<p>Exclude all example projects from release.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="2021.0"><a class="anchor" href="#2021.0"></a>2021.0</h4>
<div class="sect4">
<h5 id="2021.0.2"><a class="anchor" href="#2021.0.2"></a>2021.0.2</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This will already be the last release of the 2021.0 line.
      2021.1 will be API compatible but not ABI compatible, as some classes have
      been changed into interfaces.
      That means it is not a drop in replacement, but your application needs to be recompiled.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="features6"><a class="anchor" href="#features6"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-157 - Provide a method to turn a Java map into an expression.</p>
</li>
<li>
<p>GH-158 - Improve pretty printing of subqueries.</p>
</li>
<li>
<p>Allow the use of raw cypher as expressions.</p>
</li>
<li>
<p>Allow symbolic names to be used as aliases.</p>
</li>
<li>
<p>Cache some symbolic names.</p>
</li>
<li>
<p>Add support for the keys() function.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="documentation5"><a class="anchor" href="#documentation5"></a> Documentation</h6>
<div class="ulist">
<ul>
<li>
<p>GH-152 - Document usage of PatterElement in tests.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes7"><a class="anchor" href="#bugfixes7"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>GH-149 - Avoid possible stackoverflow exception during visitor traversal.</p>
</li>
<li>
<p>GH-159 - Fix missing labels for nodes after <code>WITH</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping6"><a class="anchor" href="#housekeeping6"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>GH-148 - Add jQAssistant rules and improve building documentation.</p>
</li>
<li>
<p>Add Maven PMD plugin.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thanks <a href="https://github.com/Andy2003">Andy</a> for the improvements of the pretty printer.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2021.0.1"><a class="anchor" href="#2021.0.1"></a>2021.0.1</h5>
<div class="sect5">
<h6 id="features7"><a class="anchor" href="#features7"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-147 - Configuration infrastructure for renderer.
First use case being a simple, pretty printing renderer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The feature looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var c = node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Configuration</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>);
var d = node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cypher-DSL</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>);

var mergeStatement = merge(c.relationshipTo(d, <span class="string"><span class="delimiter">&quot;</span><span class="content">CONFIGURES</span><span class="delimiter">&quot;</span></span>))
    .onCreate()
        .set(
            d.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>).to(literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">2021.0.1</span><span class="delimiter">&quot;</span></span>)),
            c.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">prettyPrint</span><span class="delimiter">&quot;</span></span>).to(literalTrue())
        )
    .onMatch().set(c.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">indentStyle</span><span class="delimiter">&quot;</span></span>).to(literalOf(<span class="string"><span class="delimiter">&quot;</span><span class="content">TAB</span><span class="delimiter">&quot;</span></span>)))
    .returning(d).build();

var renderer = <span class="predefined-type">Renderer</span>.getRenderer(<span class="predefined-type">Configuration</span>.prettyPrinting());
<span class="predefined-type">System</span>.out.println(renderer.render(mergeStatement));</code></pre>
</div>
</div>
<div class="paragraph">
<p>and gives you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="cypher">MERGE (c:Configuration)-[:CONFIGURES]-&gt;(d:`Cypher-DSL`)
  ON CREATE SET d.version = '2021.0.1', c.prettyPrint = true
  ON MATCH SET c.indentStyle = 'TAB'
RETURN d</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2021.0.0"><a class="anchor" href="#2021.0.0"></a>2021.0.0</h5>
<div class="paragraph">
<p>2021.0.0 comes with a lot of new features.
Thanks to <a href="https://github.com/Andy2003">Andy</a> for his contributions!</p>
</div>
<div class="paragraph">
<p>Andy is one of our first users outside <a href="https://github.com/spring-projects/spring-data-neo4j">Spring Data Neo4j 6</a>.
He started to use the Cypher-DSL in <a href="https://github.com/neo4j-graphql/neo4j-graphql-java">Neo4j GraphQL Java</a>.
Neo4j GraphQL Java is a library to translate GraphQL based schemas and queries to Cypher and execute those statements with the Neo4j database.
It can be used from a wide variety of frameworks.</p>
</div>
<div class="paragraph">
<p>We are happy and proud to be part of this and even more so about the input and contribution we got back from Andy.</p>
</div>
<div class="paragraph">
<p>Of course thanks for your input in form of tickets and discussions go out to @utnaf, @aaramg, @K-Lovelace and @maximelovino as well!</p>
</div>
<div class="sect5">
<h6 id="noteworthy"><a class="anchor" href="#noteworthy"></a>Noteworthy</h6>
<div class="paragraph">
<p>Two things should be mentioned:</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/neo4j-contrib/cypher-dsl/commit/2d0c98af853c72d4cd61099c9d8f3209b7e4c7c6">bugfix for GH-121</a> might
change behavior for some users:
The changes prevents the forced rendering of an alias for objects when the original object - the one that has been aliased
- is passed down to the DSL after an alias has been created.</p>
</div>
<div class="paragraph">
<p>The original intention for that behaviour was related to Map projection, in which the alias is actually rendered before the object.</p>
</div>
<div class="paragraph">
<p>So now the use of an aliased expression the first time triggers <code>a AS b</code> respectively <code>b: a</code> in a map projection.
All further calls will just render <code>b</code>. If the <strong>original</strong> object is used again, <code>a</code> will be rendered. If that is not desired
in your query and you rely on the alias, make sure you use the aliased expression returned from <code>.as("someAlias")</code>.</p>
</div>
<div class="paragraph">
<p>The other thing are the combined features GH-135 and GH-146.
The <code>Statement</code> class has become a fully fledged accessor to the Cypher String and the parameters used and if provided,
the values for those. The following shows a small example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">var person = Cypher.node(<span class="string"><span class="delimiter">&quot;</span><span class="content">Person</span><span class="delimiter">&quot;</span></span>).named(<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>);
var statement = Cypher
    .match(person)
    .where(person.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">nickname</span><span class="delimiter">&quot;</span></span>).isEqualTo(Cypher.parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">nickname</span><span class="delimiter">&quot;</span></span>)))
    .set(
        person.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>).to(Cypher.parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>).withValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Thomas</span><span class="delimiter">&quot;</span></span>)),
        person.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).to(Cypher.parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Anderson</span><span class="delimiter">&quot;</span></span>))
    )
    .returning(person)
    .build();

assertThat(statement.getCypher())
    .isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">MATCH (p:`Person`) WHERE p.nickname = $nickname SET p.firstName = $firstName, p.name = $name RETURN p</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; parameterNames = statement.getParameterNames();
assertThat(parameterNames).containsExactlyInAnyOrder(<span class="string"><span class="delimiter">&quot;</span><span class="content">nickname</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; parameters = statement.getParameters();
assertThat(parameters).hasSize(<span class="integer">2</span>);
assertThat(parameters).containsEntry(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Thomas</span><span class="delimiter">&quot;</span></span>);
assertThat(parameters).containsEntry(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Anderson</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="features8"><a class="anchor" href="#features8"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-122 - Add support for index hints.</p>
</li>
<li>
<p>GH-123 - Expose nested building of nested properties as public API.</p>
</li>
<li>
<p>GH-124 - Add support for Neo4j&#8217;s mathematical functions.</p>
</li>
<li>
<p>GH-127 - Allow dynamic property lookup.</p>
</li>
<li>
<p>GH-128 - Provide asConditions for RelationshipPatterns.</p>
</li>
<li>
<p>GH-129 - Allow Expressions as Parameter for Skip and Limit.</p>
</li>
<li>
<p>GH-131 - Add support for projections on symbolic names.</p>
</li>
<li>
<p>GH-133 - Allow symbolic names to be used as condition.</p>
</li>
<li>
<p>GH-135 - Collect parameters defined on a statement.</p>
</li>
<li>
<p>GH-141 - Provide a property function on all expressions.</p>
</li>
<li>
<p>GH-142 - Provide a point function accepting generic expressions as parameter.</p>
</li>
<li>
<p>GH-146 - Allow a statement to render itself.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="documentation6"><a class="anchor" href="#documentation6"></a> Documentation</h6>
<div class="ulist">
<ul>
<li>
<p>GH-126 - Document how to call arbitrary functions and procedures.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes8"><a class="anchor" href="#bugfixes8"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>Prevent double rendering of Node content when using generated names.</p>
</li>
<li>
<p>GH-121 - Don&#8217;t force rendering of aliases when the original object is used.</p>
</li>
<li>
<p>GH-137 - Fix grouping of nested conditions.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping7"><a class="anchor" href="#housekeeping7"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>Switch to GraalVM 20.3.0.</p>
</li>
<li>
<p>GH-125 - Use GraalVM image from ghcr.io.</p>
</li>
<li>
<p>GH-139 - Ensure indention via tabs.</p>
</li>
<li>
<p>GH-140 - Provide editorconfig.</p>
</li>
<li>
<p>GH-143 - Remove union types.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="2020.1"><a class="anchor" href="#2020.1"></a>2020.1</h4>
<div class="sect4">
<h5 id="2020.1.6"><a class="anchor" href="#2020.1.6"></a>2020.1.6</h5>
<div class="paragraph">
<p>No new features.
Re-released 2020.1.5 due downtime and staging issues of oss.sonatype.org.</p>
</div>
</div>
<div class="sect4">
<h5 id="2020.1.5"><a class="anchor" href="#2020.1.5"></a>2020.1.5</h5>
<div class="sect5">
<h6 id="features9"><a class="anchor" href="#features9"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-116 - Add support for creating calls to Neo4j reduce().</p>
</li>
<li>
<p>GH-119 - Add support for passing symbolic names to nodes and relationships functions.</p>
</li>
<li>
<p>GH-117 - Introduce mutating operator.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2020.1.4"><a class="anchor" href="#2020.1.4"></a>2020.1.4</h5>
<div class="sect5">
<h6 id="features10"><a class="anchor" href="#features10"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-114 - Support chained properties.</p>
</li>
<li>
<p>GH-115 - Support named items in YIELD and symbolic names as NamedPath reference.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2020.1.3"><a class="anchor" href="#2020.1.3"></a>2020.1.3</h5>
<div class="sect5">
<h6 id="features11"><a class="anchor" href="#features11"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-111 - Provide a programmatic way of creating an optional match.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes9"><a class="anchor" href="#bugfixes9"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>GH-110 - Fix collapsing of empty conditions.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2020.1.2"><a class="anchor" href="#2020.1.2"></a>2020.1.2</h5>
<div class="sect5">
<h6 id="features12"><a class="anchor" href="#features12"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-88 - Add support for Neo4j 4.0 subqueries.</p>
</li>
<li>
<p>GH-104 - Add support for merge actions.</p>
</li>
<li>
<p>GH-101 - Introduce asFunction on an ongoing call definition.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes10"><a class="anchor" href="#bugfixes10"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>GH-106 - Escape symbolic names, property lookups, aliases and map keys.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping8"><a class="anchor" href="#housekeeping8"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>GH-105 - Remove ::set-env from GH-Actions ci.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="furtherimprovements"><a class="anchor" href="#furtherimprovements"></a>Further improvements:</h6>
<div class="ulist">
<ul>
<li>
<p>Add support for EXPLAIN and PROFILE keywords.</p>
</li>
<li>
<p>Qualify a yield call (only relevant for JDK15+)</p>
</li>
<li>
<p>Fix wrong offsets in the documentation.</p>
</li>
<li>
<p>Improve JavaDoc and document internal API.</p>
</li>
<li>
<p>Allow <code>WITH</code> clause after <code>YIELD</code>.</p>
</li>
<li>
<p>Improve reusability of fragments.</p>
</li>
<li>
<p>Make ORDER clause buildable.</p>
</li>
<li>
<p>Remove parts of an experimental API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We do publish the Project info now: <a href="http://neo4j-contrib.github.io/cypher-dsl/current/project-info/project-info.html">Project info</a>,
including the <a href="http://neo4j-contrib.github.io/cypher-dsl/current/project-info/apidocs/index.html">Java API</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2020.1.1"><a class="anchor" href="#2020.1.1"></a>2020.1.1</h5>
<div class="sect5">
<h6 id="features13"><a class="anchor" href="#features13"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>List comprehensions can now be build based on named paths.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2020.1.0"><a class="anchor" href="#2020.1.0"></a>2020.1.0</h5>
<div class="sect5">
<h6 id="features14"><a class="anchor" href="#features14"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-74 - Automatically generate symbolic name if required: <code>Node</code> and <code>Relationship</code> objects generate a symbolic name if required and not set</p>
</li>
<li>
<p>Added several new functions</p>
<div class="ulist">
<ul>
<li>
<p>GH-77 <code>properties()</code></p>
</li>
<li>
<p>GH-81 <code>relationships()</code></p>
</li>
<li>
<p>GH-83 <code>startNode()</code>, <code>endNode()</code>,</p>
</li>
<li>
<p>GH-89 All temporal functions</p>
</li>
</ul>
</div>
</li>
<li>
<p>GH-76 - Added the list operator (<code>[]</code> for accessing sub lists and indexes).</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="bugfixes11"><a class="anchor" href="#bugfixes11"></a> Bug Fixes</h6>
<div class="ulist">
<ul>
<li>
<p>GH-82 - Expose all necessary interfaces for <code>call</code></p>
</li>
<li>
<p>GH-84 - Fix rendering of nested sub trees.</p>
</li>
<li>
<p>GH-95 - NPE during the creation of map projections</p>
</li>
<li>
<p>GH-96 - Make sure aliased expressions are not rendered multiple times.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping9"><a class="anchor" href="#housekeeping9"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>GH-67 - Improvements in regards of Java generics.</p>
</li>
<li>
<p>GH-68 - Clean up the Functions api.</p>
</li>
<li>
<p>GH-69 - Avoid star and static imports.</p>
</li>
<li>
<p>GH-72 - Some release cleanup</p>
</li>
<li>
<p>GH-75 - Move Assert to internal utils package.</p>
</li>
<li>
<p>GH-89 - <code>RelationshipDetails</code> is now internal API.</p>
</li>
<li>
<p>GH-93 - Ensure compatibility with GraalVM native.</p>
</li>
<li>
<p>GH-94 - Bring back SymbolicName#concat.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="2020.0"><a class="anchor" href="#2020.0"></a>2020.0</h4>
<div class="sect4">
<h5 id="2020.0.1"><a class="anchor" href="#2020.0.1"></a>2020.0.1</h5>
<div class="paragraph">
<p>This is the first patch release for the rebooted Cypher-DSL project.</p>
</div>
<div class="sect5">
<h6 id="features15"><a class="anchor" href="#features15"></a> Features</h6>
<div class="ulist">
<ul>
<li>
<p>GH-64 - Add function invocation for builtin point function.</p>
</li>
<li>
<p>GH-65 - Add support for defining calls to stored procedures.</p>
</li>
<li>
<p><code>Cypher.literalOf</code> accepts now <code>boolean</code> values as well</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="housekeeping10"><a class="anchor" href="#housekeeping10"></a> Housekeeping</h6>
<div class="ulist">
<ul>
<li>
<p>Improvements to the manual and Java Docs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thanks to @Andy2003 for contributing to this release.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="2020.0.0"><a class="anchor" href="#2020.0.0"></a>2020.0.0</h5>
<div class="paragraph">
<p>This is the first version of the rebooted Neo4j Cypher-DSL project. This version has been extracted from <a href="https://github.com/neo4j/sdn-rx">SDN-RX</a>.</p>
</div>
<div class="paragraph">
<p>It&#8217;s a completely revamped API and we use it in all places in SDN/RX for generating Cypher-Queries.</p>
</div>
<div class="paragraph">
<p>We use <a href="https://calver.org">CalVer</a> in the same way Spring does
since early 2020 (see <a href="https://spring.io/blog/2020/04/30/updates-to-spring-versions">Updates to Spring Versions</a>) from this release onwards.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll find the manual of the latest release version under <a href="http://neo4j-contrib.github.io/cypher-dsl/current/" class="bare">http://neo4j-contrib.github.io/cypher-dsl/current/</a> and the current development version - or <em>main</em> - under <a href="http://neo4j-contrib.github.io/cypher-dsl/main/" class="bare">http://neo4j-contrib.github.io/cypher-dsl/main/</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-07-16 13:23:43 UTC
</div>
</div>
</body>
</html>